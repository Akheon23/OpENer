<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OpENer - Open Source EtherNet/IP(TM)  I/O Target Stack: src/cip/cipioconnection.c Source File</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpENer - Open Source EtherNet/IP(TM)  I/O Target Stack
   &#160;<span id="projectnumber">1.2</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('df/d03/cipioconnection_8c.html','../../');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">src/cip/cipioconnection.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../df/d03/cipioconnection_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*******************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (c) 2011, Rockwell Automation, Inc.</span>
<a name="l00003"></a>00003 <span class="comment"> * All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> ******************************************************************************/</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;stdbool.h&gt;</span>
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d45/cipioconnection_8h.html">cipioconnection.h</a>&quot;</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;<a class="code" href="../../da/dc2/generic__networkhandler_8h.html">generic_networkhandler.h</a>&quot;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/da3/cipconnectionmanager_8h.html">cipconnectionmanager.h</a>&quot;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/cipassembly_8h.html">cipassembly.h</a>&quot;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dad/ciptcpipinterface_8h.html" title="Public interface of the TCP/IP Interface Object.">ciptcpipinterface.h</a>&quot;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d14/cipcommon_8h.html">cipcommon.h</a>&quot;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dc0/appcontype_8h.html">appcontype.h</a>&quot;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/dff/cpf_8h.html">cpf.h</a>&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d1b/trace_8h.html" title="Tracing infrastructure for OpENer.">trace.h</a>&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/dec/endianconv_8h.html" title="Responsible for Endianess conversion.">endianconv.h</a>&quot;</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="comment">/*The port to be used per default for I/O messages on UDP.*/</span>
<a name="l00024"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a46f1aa5e4d7142036318ba3c9f2707ea">00024</a> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../df/d03/cipioconnection_8c.html#a46f1aa5e4d7142036318ba3c9f2707ea">kOpenerEipIoUdpPort</a> = 0x08AE;
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="comment">/* producing multicast connection have to consider the rules that apply for</span>
<a name="l00027"></a>00027 <span class="comment"> * application connection types.</span>
<a name="l00028"></a>00028 <span class="comment"> */</span>
<a name="l00029"></a>00029 <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a5dea6fc1be0ed4ecf5d9e4f932d52106">OpenProducingMulticastConnection</a>(
<a name="l00030"></a>00030   <a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *connection_object,
<a name="l00031"></a>00031   <a class="code" href="../../db/d80/structCipCommonPacketFormatData.html" title="A variant of a CPF packet, including item count, one address item, one data item, and two Sockaddr In...">CipCommonPacketFormatData</a> *common_packet_format_data);
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a9e2ce4666173987646cf60ce3422d7b4">OpenMulticastConnection</a>(
<a name="l00034"></a>00034   <a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42" title="Communication direction of an UDP socket; consuming is receiver, producing is sender.">UdpCommuncationDirection</a> direction,
<a name="l00035"></a>00035   <a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *connection_object,
<a name="l00036"></a>00036   <a class="code" href="../../db/d80/structCipCommonPacketFormatData.html" title="A variant of a CPF packet, including item count, one address item, one data item, and two Sockaddr In...">CipCommonPacketFormatData</a> *common_packet_format_data);
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#add645b42730b2cea369523949c6b9745" title="Open a Point2Point connection dependent on pa_direction.">OpenConsumingPointToPointConnection</a>(
<a name="l00039"></a>00039   <a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *<span class="keyword">const</span> connection_object,
<a name="l00040"></a>00040   <a class="code" href="../../db/d80/structCipCommonPacketFormatData.html" title="A variant of a CPF packet, including item count, one address item, one data item, and two Sockaddr In...">CipCommonPacketFormatData</a> *<span class="keyword">const</span> common_packet_format_data);
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#aa3b58fd216ec6712abc29ef84b33006d">OpenProducingPointToPointConnection</a>(
<a name="l00043"></a>00043   <a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *connection_object,
<a name="l00044"></a>00044   <a class="code" href="../../db/d80/structCipCommonPacketFormatData.html" title="A variant of a CPF packet, including item count, one address item, one data item, and two Sockaddr In...">CipCommonPacketFormatData</a> *common_packet_format_data);
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <a class="code" href="../../d7/d69/typedefs_8h.html#ac1b4cfa25b4f5def62f23b455dd395d8">EipUint16</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a68b99df85d462657b12a854316c168f5">HandleConfigData</a>(<a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *connection_object);
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 <span class="comment">/* Regularly close the IO connection. If it is an exclusive owner or input only</span>
<a name="l00049"></a>00049 <span class="comment"> * connection and in charge of the connection a new owner will be searched</span>
<a name="l00050"></a>00050 <span class="comment"> */</span>
<a name="l00051"></a>00051 <span class="keywordtype">void</span> <a class="code" href="../../df/d03/cipioconnection_8c.html#a730b410a0cdbc6a456973c0e51568968">CloseIoConnection</a>(<a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *connection_object);
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 <span class="keywordtype">void</span> <a class="code" href="../../df/d03/cipioconnection_8c.html#a7e4923f4b027d489d9933b52f6fd7007">HandleIoConnectionTimeOut</a>(<a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *connection_object);
<a name="l00054"></a>00054 
<a name="l00061"></a>00061 <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a20f1bc1c4cc4470cf371f94d51814de2" title="Send the data from the produced CIP Object of the connection via the socket of the connection object ...">SendConnectedData</a>(<a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *connection_object);
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a73bfd5fa3bc96e11219d0b24d70b88c7">HandleReceivedIoConnectionData</a>(
<a name="l00064"></a>00064   <a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *connection_object,
<a name="l00065"></a>00065   <span class="keyword">const</span> <a class="code" href="../../d7/d69/typedefs_8h.html#aa0c108ee762a27720919a4634643040e">EipUint8</a> *data,
<a name="l00066"></a>00066   <a class="code" href="../../d7/d69/typedefs_8h.html#ac1b4cfa25b4f5def62f23b455dd395d8">EipUint16</a> data_length);
<a name="l00067"></a>00067 
<a name="l00068"></a>00068 <span class="comment">/**** Global variables ****/</span>
<a name="l00069"></a><a class="code" href="../../de/d45/cipioconnection_8h.html#a534c0a24266039f7ced0d36b7c5496bc">00069</a> <a class="code" href="../../d7/d69/typedefs_8h.html#aa0c108ee762a27720919a4634643040e">EipUint8</a> *<a class="code" href="../../df/d03/cipioconnection_8c.html#a534c0a24266039f7ced0d36b7c5496bc">g_config_data_buffer</a> = NULL; 
<a name="l00070"></a><a class="code" href="../../de/d45/cipioconnection_8h.html#ad20328302a359540d55f48ae36f7237d">00070</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../df/d03/cipioconnection_8c.html#ad20328302a359540d55f48ae36f7237d">g_config_data_length</a> = 0; 
<a name="l00072"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a4901ec04ad1ac886626e556c60f12196">00072</a> <a class="code" href="../../d7/d69/typedefs_8h.html#abf2dd49262551294eb990ef8746a2767">EipUint32</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a4901ec04ad1ac886626e556c60f12196">g_run_idle_state</a>; 
<a name="l00074"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#ac1ef9c10ff4921452840b0de66bb12cf">00074</a> <a class="code" href="../../d7/d69/typedefs_8h.html#ac1b4cfa25b4f5def62f23b455dd395d8">EipUint16</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#ac1ef9c10ff4921452840b0de66bb12cf">ProcessProductionInhibitTime</a>(<a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *io_connection_object)
<a name="l00075"></a>00075 {
<a name="l00076"></a>00076   <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#a40e6630a28ca2e52e3f57b010035cbc0a66cd7ba622075121f11c67671a1d8645">kConnectionObjectTransportClassTriggerProductionTriggerCyclic</a>
<a name="l00077"></a>00077        == <a class="code" href="../../df/d91/cipconnectionobject_8c.html#ad29970b643c2677739c3f0e0a7a58f37">ConnectionObjectGetTransportClassTriggerProductionTrigger</a>(
<a name="l00078"></a>00078          io_connection_object) ) {
<a name="l00079"></a>00079     <span class="keywordflow">if</span> ( 256 ==
<a name="l00080"></a>00080          <a class="code" href="../../df/d91/cipconnectionobject_8c.html#a2d8f4835df1f11d188736b854d28e7d9">ConnectionObjectGetProductionInhibitTime</a>(io_connection_object) ) {
<a name="l00081"></a>00081       <a class="code" href="../../d1/d1b/trace_8h.html#a9a8a4741005c175e598afc162f68982a">OPENER_TRACE_INFO</a>(<span class="stringliteral">&quot;No PIT segment available\n&quot;</span>);
<a name="l00082"></a>00082       <span class="comment">/* there was no PIT segment in the connection path; set PIT to one fourth of RPI */</span>
<a name="l00083"></a>00083       <a class="code" href="../../df/d91/cipconnectionobject_8c.html#a2e4314abc5d0e4684f16b1bc91088e7b">ConnectionObjectSetProductionInhibitTime</a>(io_connection_object,
<a name="l00084"></a>00084                                                <a class="code" href="../../df/d91/cipconnectionobject_8c.html#a5a8dca52f318b4aca92f10de1c1072fc">ConnectionObjectGetTToORequestedPacketInterval</a>(
<a name="l00085"></a>00085                                                  io_connection_object)
<a name="l00086"></a>00086                                                / 4000);
<a name="l00087"></a>00087     } <span class="keywordflow">else</span> {
<a name="l00088"></a>00088       <span class="comment">/* If a production inhibit time is provided, it needs to be smaller than the Requested Packet Interval */</span>
<a name="l00089"></a>00089       <span class="keywordflow">if</span> ( <a class="code" href="../../df/d91/cipconnectionobject_8c.html#a2d8f4835df1f11d188736b854d28e7d9">ConnectionObjectGetProductionInhibitTime</a>(io_connection_object)
<a name="l00090"></a>00090            &gt; (<a class="code" href="../../df/d91/cipconnectionobject_8c.html#a5a8dca52f318b4aca92f10de1c1072fc">ConnectionObjectGetTToORequestedPacketInterval</a>(
<a name="l00091"></a>00091                 io_connection_object)
<a name="l00092"></a>00092               / 1000) ) {
<a name="l00093"></a>00093         <span class="comment">/* see section C-1.4.3.3 */</span>
<a name="l00094"></a>00094         <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759a99741924898d08d2539703ac8bb1c9b0">kConnectionManagerExtendedStatusCodeRpiNotSupported</a>; 
<a name="l00095"></a>00095       }
<a name="l00096"></a>00096     }
<a name="l00097"></a>00097   }
<a name="l00098"></a>00098   <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759a299259d157a6ac077f1c5c8904ceaef8">kConnectionManagerExtendedStatusCodeSuccess</a>;
<a name="l00099"></a>00099 }
<a name="l00100"></a>00100 
<a name="l00101"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#ab3282f146a3ea91c90cf14c32206ee8c">00101</a> <span class="keywordtype">void</span> <a class="code" href="../../df/d03/cipioconnection_8c.html#ab3282f146a3ea91c90cf14c32206ee8c">SetIoConnectionCallbacks</a>(<a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *<span class="keyword">const</span> io_connection_object) {
<a name="l00102"></a>00102   io_connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#aa1cbdb9fe8b98c23e728f846a8b166a4">connection_close_function</a> = <a class="code" href="../../df/d03/cipioconnection_8c.html#a730b410a0cdbc6a456973c0e51568968">CloseIoConnection</a>;
<a name="l00103"></a>00103   io_connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a5f34750287366fbfefb19e5e9c5433ff">connection_timeout_function</a> = <a class="code" href="../../df/d03/cipioconnection_8c.html#a7e4923f4b027d489d9933b52f6fd7007">HandleIoConnectionTimeOut</a>;
<a name="l00104"></a>00104   io_connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a8337f1c87be14116f6ebc5e50e746a0c">connection_send_data_function</a> = <a class="code" href="../../df/d03/cipioconnection_8c.html#a20f1bc1c4cc4470cf371f94d51814de2" title="Send the data from the produced CIP Object of the connection via the socket of the connection object ...">SendConnectedData</a>;
<a name="l00105"></a>00105   io_connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#aa764f4fb83441826b615422f18f4c5a2">connection_receive_data_function</a> =
<a name="l00106"></a>00106     <a class="code" href="../../df/d03/cipioconnection_8c.html#a73bfd5fa3bc96e11219d0b24d70b88c7">HandleReceivedIoConnectionData</a>;
<a name="l00107"></a>00107 }
<a name="l00108"></a>00108 
<a name="l00109"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#ac00a39ab755db54e4abf917618ff9849">00109</a> <a class="code" href="../../d7/d69/typedefs_8h.html#ac1b4cfa25b4f5def62f23b455dd395d8">EipUint16</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#ac00a39ab755db54e4abf917618ff9849">SetupIoConnectionOriginatorToTargetConnectionPoint</a>(
<a name="l00110"></a>00110   <a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *<span class="keyword">const</span> io_connection_object,
<a name="l00111"></a>00111   <a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *<span class="keyword">const</span> RESTRICT connection_object
<a name="l00112"></a>00112   ) {
<a name="l00113"></a>00113   <a class="code" href="../../da/d8e/structcip__class.html" title="Class is a subclass of Instance.">CipClass</a> *<span class="keyword">const</span> assembly_class = <a class="code" href="../../d2/dc9/group__CIP__API.html#ga98bd609c80ece316406363575b4a89ea" title="Get a pointer to a CIP object with given class code.">GetCipClass</a>(kCipAssemblyClassCode);
<a name="l00114"></a>00114   <a class="code" href="../../d5/dc5/structcip__instance.html">CipInstance</a> *instance = NULL;
<a name="l00115"></a>00115   <span class="keywordflow">if</span> ( NULL
<a name="l00116"></a>00116        != ( instance =
<a name="l00117"></a>00117               <a class="code" href="../../d2/dc9/group__CIP__API.html#gaa50395aca91b378c297d6ad919df210e" title="Get a pointer to an instance.">GetCipInstance</a>(
<a name="l00118"></a>00118                 assembly_class,
<a name="l00119"></a>00119                 io_connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a27028c320baa22cd19299de5580da173">consumed_path</a>.<a class="code" href="../../d9/de3/structconnection__path__epath.html#ac5361794a9129b86407bc843e8749038">instance_id</a>) ) ) {
<a name="l00120"></a>00120     <span class="comment">/* consuming Connection Point is present */</span>
<a name="l00121"></a>00121     io_connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#adc233577b4d61f10079dad1640bf58b9">consuming_instance</a> = instance;
<a name="l00122"></a>00122     io_connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#ac13e63588a60dbbbaa40c844e57c8d1f">consumed_connection_path_length</a> = 6;
<a name="l00123"></a>00123     <span class="comment">/*io_connection_object-&gt;consumed_path.class_id =</span>
<a name="l00124"></a>00124 <span class="comment">       io_connection_object-&gt;connection_path.class_id;</span>
<a name="l00125"></a>00125 <span class="comment">       io_connection_object-&gt;consumed_connection_path.instance_number =</span>
<a name="l00126"></a>00126 <span class="comment">       io_connection_object-&gt;connection_path.connection_point[</span>
<a name="l00127"></a>00127 <span class="comment">        kConnectionPointConsumer];*/</span>
<a name="l00128"></a>00128     io_connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a27028c320baa22cd19299de5580da173">consumed_path</a>.<a class="code" href="../../d9/de3/structconnection__path__epath.html#a8e06df09d8e84593faaf7f3bfa5b5e6f">attribute_id_or_connection_point</a> = 3;
<a name="l00129"></a>00129     <span class="keywordtype">int</span> data_size = <a class="code" href="../../df/d91/cipconnectionobject_8c.html#ac8eec747e3eb538b8208f84bb1cd876c">ConnectionObjectGetOToTConnectionSize</a>(io_connection_object);
<a name="l00130"></a>00130     <span class="keywordtype">int</span> diff_size = 0;
<a name="l00131"></a>00131 
<a name="l00132"></a>00132     <span class="comment">/* an assembly object should always have an attribute 3 */</span>
<a name="l00133"></a>00133     <a class="code" href="../../d4/d62/structCipAttributeStruct.html">CipAttributeStruct</a> *attribute = <a class="code" href="../../d2/dc9/group__CIP__API.html#ga5a14c8d76acacb09312b709bb0a76265" title="Get a pointer to an instance&#39;s attribute.">GetCipAttribute</a>(instance,
<a name="l00134"></a>00134                                                     io_connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a27028c320baa22cd19299de5580da173">consumed_path</a>.<a class="code" href="../../d9/de3/structconnection__path__epath.html#a8e06df09d8e84593faaf7f3bfa5b5e6f">attribute_id_or_connection_point</a>);
<a name="l00135"></a>00135     <a class="code" href="../../dd/d1b/POSIX_2sample__application_2opener__user__conf_8h.html#a7b5e7d71f666ba97788b35be1617c40a">OPENER_ASSERT</a>(attribute != NULL);
<a name="l00136"></a>00136     <span class="keywordtype">bool</span> is_heartbeat = ( ( (<a class="code" href="../../de/dd7/structCipByteArray.html" title="CIP Byte Array.">CipByteArray</a> *) attribute-&gt;<a class="code" href="../../d4/d62/structCipAttributeStruct.html#a859d8bdd91ff42b1ce0ff5f8053d2b40">data</a> )-&gt;length == 0 );
<a name="l00137"></a>00137     <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#a7d9579ba2ab49ebf08a1e8b124f7c68fa3985efbf81d9660d0969a318d03fe3f6">kConnectionObjectTransportClassTriggerTransportClass1</a>
<a name="l00138"></a>00138          == <a class="code" href="../../df/d91/cipconnectionobject_8c.html#a0f3d8e6f21712dbef3fb2e1da42f35ba">ConnectionObjectGetTransportClassTriggerTransportClass</a>(
<a name="l00139"></a>00139            io_connection_object) ) {
<a name="l00140"></a>00140       <span class="comment">/* class 1 connection */</span>
<a name="l00141"></a>00141       data_size -= 2; <span class="comment">/* remove 16-bit sequence count length */</span>
<a name="l00142"></a>00142       diff_size += 2;
<a name="l00143"></a>00143     }
<a name="l00144"></a>00144     <span class="keywordflow">if</span> ( (kOpenerConsumedDataHasRunIdleHeader) &amp;&amp; (data_size &gt; 0)
<a name="l00145"></a>00145          &amp;&amp; (!is_heartbeat) ) {
<a name="l00146"></a>00146       <span class="comment">/* we only have an run idle header if it is not an heartbeat connection */</span>
<a name="l00147"></a>00147       data_size -= 4; <span class="comment">/* remove the 4 bytes needed for run/idle header */</span>
<a name="l00148"></a>00148       diff_size += 4;
<a name="l00149"></a>00149     }
<a name="l00150"></a>00150     <span class="keywordflow">if</span> ( ( (<a class="code" href="../../de/dd7/structCipByteArray.html" title="CIP Byte Array.">CipByteArray</a> *) attribute-&gt;<a class="code" href="../../d4/d62/structCipAttributeStruct.html#a859d8bdd91ff42b1ce0ff5f8053d2b40">data</a> )-&gt;length != data_size ) {
<a name="l00151"></a>00151       <span class="comment">/*wrong connection size */</span>
<a name="l00152"></a>00152       connection_object-&gt;correct_originator_to_target_size =
<a name="l00153"></a>00153         ( (<a class="code" href="../../de/dd7/structCipByteArray.html" title="CIP Byte Array.">CipByteArray</a> *) attribute-&gt;<a class="code" href="../../d4/d62/structCipAttributeStruct.html#a859d8bdd91ff42b1ce0ff5f8053d2b40">data</a> )-&gt;length + diff_size;
<a name="l00154"></a>00154       <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759a3607b492711350b9d9979df218f0949d">kConnectionManagerExtendedStatusCodeErrorInvalidOToTConnectionSize</a>;
<a name="l00155"></a>00155     }
<a name="l00156"></a>00156   } <span class="keywordflow">else</span> {
<a name="l00157"></a>00157     <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759a40a08a853d51ce12008d4c935dbef985">kConnectionManagerExtendedStatusCodeInvalidConsumingApplicationPath</a>;
<a name="l00158"></a>00158   }
<a name="l00159"></a>00159   <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759a299259d157a6ac077f1c5c8904ceaef8">kConnectionManagerExtendedStatusCodeSuccess</a>;
<a name="l00160"></a>00160 }
<a name="l00161"></a>00161 
<a name="l00162"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a4efa3b0cf11b363c8c5f4f8c8070b43f">00162</a> <a class="code" href="../../d7/d69/typedefs_8h.html#ac1b4cfa25b4f5def62f23b455dd395d8">EipUint16</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a4efa3b0cf11b363c8c5f4f8c8070b43f">SetupIoConnectionTargetToOriginatorConnectionPoint</a>(
<a name="l00163"></a>00163   <a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *<span class="keyword">const</span> io_connection_object,
<a name="l00164"></a>00164   <a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *<span class="keyword">const</span> RESTRICT connection_object
<a name="l00165"></a>00165   ) {
<a name="l00166"></a>00166   <a class="code" href="../../df/d2f/structdoubly__linked__list__node.html">DoublyLinkedListNode</a> *node = <a class="code" href="../../d1/dc0/appcontype_8h.html#ab314e92264a974f6b8aef1327e546e2e">connection_list</a>.<a class="code" href="../../dd/de5/structDoublyLinkedList.html#a0c42f2f515a845457c2f8139136d77d0">first</a>;
<a name="l00167"></a>00167   <span class="keywordflow">while</span> (NULL != node &amp;&amp;
<a name="l00168"></a>00168          <a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#ad6b37311125336c0525f037c107e091aa8f7d20eb5adeb31d45a0bfb62dbefe9b">kConnectionObjectConnectionTypeMulticast</a> ==
<a name="l00169"></a>00169          <a class="code" href="../../df/d91/cipconnectionobject_8c.html#ad61ad2b2c18480a141e5df346e32be02">ConnectionObjectGetTToOConnectionType</a>(io_connection_object) ) {
<a name="l00170"></a>00170     <a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *iterator = node-&gt;<a class="code" href="../../df/d2f/structdoubly__linked__list__node.html#a2e39fa639f2c160c7ba295cb583ca953">data</a>;
<a name="l00171"></a>00171     <span class="keywordflow">if</span>(io_connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a8d8986dcd044a68134f9e52f856718ce">produced_path</a>.<a class="code" href="../../d9/de3/structconnection__path__epath.html#ac5361794a9129b86407bc843e8749038">instance_id</a> ==
<a name="l00172"></a>00172        iterator-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a8d8986dcd044a68134f9e52f856718ce">produced_path</a>.<a class="code" href="../../d9/de3/structconnection__path__epath.html#ac5361794a9129b86407bc843e8749038">instance_id</a>) {
<a name="l00173"></a>00173       <span class="comment">//Check parameters</span>
<a name="l00174"></a>00174       <span class="keywordflow">if</span>( <a class="code" href="../../df/d91/cipconnectionobject_8c.html#a5a8dca52f318b4aca92f10de1c1072fc">ConnectionObjectGetTToORequestedPacketInterval</a>(io_connection_object)
<a name="l00175"></a>00175           !=
<a name="l00176"></a>00176           <a class="code" href="../../df/d91/cipconnectionobject_8c.html#a5a8dca52f318b4aca92f10de1c1072fc">ConnectionObjectGetTToORequestedPacketInterval</a>(iterator) ) {
<a name="l00177"></a>00177         <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759a6291dd8e01f32f0193aac33ebf902ec3">kConnectionManagerExtendedStatusCodeErrorRpiValuesNotAcceptable</a>;
<a name="l00178"></a>00178       }
<a name="l00179"></a>00179       <span class="keywordflow">if</span>( <a class="code" href="../../df/d91/cipconnectionobject_8c.html#a3eb72e7befca17493e2cec4ebfda8552">ConnectionObjectGetTToOConnectionSizeType</a>(
<a name="l00180"></a>00180             io_connection_object) !=
<a name="l00181"></a>00181           <a class="code" href="../../df/d91/cipconnectionobject_8c.html#a3eb72e7befca17493e2cec4ebfda8552">ConnectionObjectGetTToOConnectionSizeType</a>(
<a name="l00182"></a>00182             iterator) ) {
<a name="l00183"></a>00183         <span class="keywordflow">return</span>
<a name="l00184"></a>00184           <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759a343534a00fd90f7b8aa594e0208729cf">kConnectionManagerExtendedStatusCodeMismatchedTToONetworkConnectionFixVar</a>;
<a name="l00185"></a>00185       }
<a name="l00186"></a>00186       <span class="keywordflow">if</span> ( <a class="code" href="../../df/d91/cipconnectionobject_8c.html#aeee7026822ffa05ebabab57a0eed1665">ConnectionObjectGetTToOPriority</a>(io_connection_object) !=
<a name="l00187"></a>00187            <a class="code" href="../../df/d91/cipconnectionobject_8c.html#aeee7026822ffa05ebabab57a0eed1665">ConnectionObjectGetTToOPriority</a>(iterator) ) {
<a name="l00188"></a>00188         <span class="keywordflow">return</span>
<a name="l00189"></a>00189           <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759ae7afa5d3624f0bbb17e53ba60fd954ab">kConnectionManagerExtendedStatusCodeMismatchedTToONetworkConnectionPriority</a>;
<a name="l00190"></a>00190       }
<a name="l00191"></a>00191 
<a name="l00192"></a>00192       <span class="keywordflow">if</span>( <a class="code" href="../../df/d91/cipconnectionobject_8c.html#a0f3d8e6f21712dbef3fb2e1da42f35ba">ConnectionObjectGetTransportClassTriggerTransportClass</a>(
<a name="l00193"></a>00193             io_connection_object) !=
<a name="l00194"></a>00194           <a class="code" href="../../df/d91/cipconnectionobject_8c.html#a0f3d8e6f21712dbef3fb2e1da42f35ba">ConnectionObjectGetTransportClassTriggerTransportClass</a>(iterator) ) {
<a name="l00195"></a>00195         <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759a13f9ddcd3a2500918f93cf815106996e">kConnectionManagerExtendedStatusCodeMismatchedTransportClass</a>;
<a name="l00196"></a>00196       }
<a name="l00197"></a>00197 
<a name="l00198"></a>00198 
<a name="l00199"></a>00199       <span class="keywordflow">if</span>( <a class="code" href="../../df/d91/cipconnectionobject_8c.html#ad29970b643c2677739c3f0e0a7a58f37">ConnectionObjectGetTransportClassTriggerProductionTrigger</a>(
<a name="l00200"></a>00200             io_connection_object) !=
<a name="l00201"></a>00201           <a class="code" href="../../df/d91/cipconnectionobject_8c.html#ad29970b643c2677739c3f0e0a7a58f37">ConnectionObjectGetTransportClassTriggerProductionTrigger</a>(iterator) )
<a name="l00202"></a>00202       {
<a name="l00203"></a>00203         <span class="keywordflow">return</span>
<a name="l00204"></a>00204           <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759ab4e28712221560fc4ea27d27becb378b">kConnectionManagerExtendedStatusCodeMismatchedTToOProductionTrigger</a>;
<a name="l00205"></a>00205       }
<a name="l00206"></a>00206 
<a name="l00207"></a>00207       <span class="keywordflow">if</span>( <a class="code" href="../../df/d91/cipconnectionobject_8c.html#a2d8f4835df1f11d188736b854d28e7d9">ConnectionObjectGetProductionInhibitTime</a>(io_connection_object) !=
<a name="l00208"></a>00208           <a class="code" href="../../df/d91/cipconnectionobject_8c.html#a2d8f4835df1f11d188736b854d28e7d9">ConnectionObjectGetProductionInhibitTime</a>(iterator) ) {
<a name="l00209"></a>00209         <span class="keywordflow">return</span>
<a name="l00210"></a>00210           <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759a6f912658085869a4e4b341c8ec13c16c">kConnectionManagerExtendedStatusCodeMismatchedTToOProductionInhibitTimeSegment</a>;
<a name="l00211"></a>00211       }
<a name="l00212"></a>00212 
<a name="l00213"></a>00213     }
<a name="l00214"></a>00214 
<a name="l00215"></a>00215     node = node-&gt;<a class="code" href="../../df/d2f/structdoubly__linked__list__node.html#aff605e502e98b61844dc494a0103b462">next</a>;
<a name="l00216"></a>00216   }
<a name="l00217"></a>00217 
<a name="l00218"></a>00218   <span class="comment">/*setup producer side*/</span>
<a name="l00219"></a>00219   <a class="code" href="../../da/d8e/structcip__class.html" title="Class is a subclass of Instance.">CipClass</a> *<span class="keyword">const</span> assembly_class = <a class="code" href="../../d2/dc9/group__CIP__API.html#ga98bd609c80ece316406363575b4a89ea" title="Get a pointer to a CIP object with given class code.">GetCipClass</a>(kCipAssemblyClassCode);
<a name="l00220"></a>00220   <a class="code" href="../../d5/dc5/structcip__instance.html">CipInstance</a> *instance = NULL;
<a name="l00221"></a>00221   <span class="keywordflow">if</span> ( NULL
<a name="l00222"></a>00222        != ( instance =
<a name="l00223"></a>00223               <a class="code" href="../../d2/dc9/group__CIP__API.html#gaa50395aca91b378c297d6ad919df210e" title="Get a pointer to an instance.">GetCipInstance</a>(
<a name="l00224"></a>00224                 assembly_class,
<a name="l00225"></a>00225                 io_connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a8d8986dcd044a68134f9e52f856718ce">produced_path</a>.<a class="code" href="../../d9/de3/structconnection__path__epath.html#ac5361794a9129b86407bc843e8749038">instance_id</a>) ) ) {
<a name="l00226"></a>00226 
<a name="l00227"></a>00227     io_connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#ac60f1a2ace4207cfd21d6f1ca0c5449b">producing_instance</a> = instance;
<a name="l00228"></a>00228     <span class="keywordtype">int</span> data_size = <a class="code" href="../../df/d91/cipconnectionobject_8c.html#ae90368c85cedeaa7a56fb0eae81eeef2">ConnectionObjectGetTToOConnectionSize</a>(io_connection_object);
<a name="l00229"></a>00229     <span class="keywordtype">int</span> diff_size = 0;
<a name="l00230"></a>00230     <span class="comment">/* an assembly object should always have an attribute 3 */</span>
<a name="l00231"></a>00231     io_connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a8d8986dcd044a68134f9e52f856718ce">produced_path</a>.<a class="code" href="../../d9/de3/structconnection__path__epath.html#a8e06df09d8e84593faaf7f3bfa5b5e6f">attribute_id_or_connection_point</a> = 3;
<a name="l00232"></a>00232     <a class="code" href="../../d4/d62/structCipAttributeStruct.html">CipAttributeStruct</a> *attribute = <a class="code" href="../../d2/dc9/group__CIP__API.html#ga5a14c8d76acacb09312b709bb0a76265" title="Get a pointer to an instance&#39;s attribute.">GetCipAttribute</a>(instance,
<a name="l00233"></a>00233                                                     io_connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a8d8986dcd044a68134f9e52f856718ce">produced_path</a>.<a class="code" href="../../d9/de3/structconnection__path__epath.html#a8e06df09d8e84593faaf7f3bfa5b5e6f">attribute_id_or_connection_point</a>);
<a name="l00234"></a>00234     <a class="code" href="../../dd/d1b/POSIX_2sample__application_2opener__user__conf_8h.html#a7b5e7d71f666ba97788b35be1617c40a">OPENER_ASSERT</a>(attribute != NULL);
<a name="l00235"></a>00235     <span class="keywordtype">bool</span> is_heartbeat = ( ( (<a class="code" href="../../de/dd7/structCipByteArray.html" title="CIP Byte Array.">CipByteArray</a> *) attribute-&gt;<a class="code" href="../../d4/d62/structCipAttributeStruct.html#a859d8bdd91ff42b1ce0ff5f8053d2b40">data</a> )-&gt;length == 0 );
<a name="l00236"></a>00236     <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#a7d9579ba2ab49ebf08a1e8b124f7c68fa3985efbf81d9660d0969a318d03fe3f6">kConnectionObjectTransportClassTriggerTransportClass1</a> ==
<a name="l00237"></a>00237          <a class="code" href="../../df/d91/cipconnectionobject_8c.html#a0f3d8e6f21712dbef3fb2e1da42f35ba">ConnectionObjectGetTransportClassTriggerTransportClass</a>(
<a name="l00238"></a>00238            io_connection_object) ) {
<a name="l00239"></a>00239       <span class="comment">/* class 1 connection */</span>
<a name="l00240"></a>00240       data_size -= 2; <span class="comment">/* remove 16-bit sequence count length */</span>
<a name="l00241"></a>00241       diff_size += 2;
<a name="l00242"></a>00242     }
<a name="l00243"></a>00243     <span class="keywordflow">if</span> ( (kOpenerProducedDataHasRunIdleHeader) &amp;&amp; (data_size &gt; 0)
<a name="l00244"></a>00244          &amp;&amp; (!is_heartbeat) ) {
<a name="l00245"></a>00245       <span class="comment">/* we only have an run idle header if it is not an heartbeat connection */</span>
<a name="l00246"></a>00246       data_size -= 4; <span class="comment">/* remove the 4 bytes needed for run/idle header */</span>
<a name="l00247"></a>00247       diff_size += 4;
<a name="l00248"></a>00248     }
<a name="l00249"></a>00249     <span class="keywordflow">if</span> ( ( (<a class="code" href="../../de/dd7/structCipByteArray.html" title="CIP Byte Array.">CipByteArray</a> *) attribute-&gt;<a class="code" href="../../d4/d62/structCipAttributeStruct.html#a859d8bdd91ff42b1ce0ff5f8053d2b40">data</a> )-&gt;length != data_size ) {
<a name="l00250"></a>00250       <span class="comment">/*wrong connection size*/</span>
<a name="l00251"></a>00251       connection_object-&gt;correct_target_to_originator_size =
<a name="l00252"></a>00252         ( (<a class="code" href="../../de/dd7/structCipByteArray.html" title="CIP Byte Array.">CipByteArray</a> *) attribute-&gt;<a class="code" href="../../d4/d62/structCipAttributeStruct.html#a859d8bdd91ff42b1ce0ff5f8053d2b40">data</a> )-&gt;length + diff_size;
<a name="l00253"></a>00253       <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759adc76a9410b4fab054d9b4e17d0c5b067">kConnectionManagerExtendedStatusCodeErrorInvalidTToOConnectionSize</a>;
<a name="l00254"></a>00254     }
<a name="l00255"></a>00255   } <span class="keywordflow">else</span> {
<a name="l00256"></a>00256     <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759ab31ee32e147e66520a313f02c5875510">kConnectionManagerExtendedStatusCodeInvalidProducingApplicationPath</a>;
<a name="l00257"></a>00257   }
<a name="l00258"></a>00258   <span class="keywordflow">return</span> <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759a299259d157a6ac077f1c5c8904ceaef8">kConnectionManagerExtendedStatusCodeSuccess</a>;
<a name="l00259"></a>00259 }
<a name="l00260"></a>00260 
<a name="l00272"></a><a class="code" href="../../de/d45/cipioconnection_8h.html#a43e270b3f9b9f6296b12285c320c95aa">00272</a> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a43e270b3f9b9f6296b12285c320c95aa" title="Establishes a new IO Type 1 Connection.">EstablishIoConnection</a>(
<a name="l00273"></a>00273   <a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *RESTRICT <span class="keyword">const</span> connection_object,
<a name="l00274"></a>00274   <a class="code" href="../../d7/d69/typedefs_8h.html#ac1b4cfa25b4f5def62f23b455dd395d8">EipUint16</a> *<span class="keyword">const</span> extended_error
<a name="l00275"></a>00275   ) {
<a name="l00276"></a>00276   <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> eip_status = <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709af172c48a50748097201d49b469c75f7a">kEipStatusOk</a>;
<a name="l00277"></a>00277 
<a name="l00278"></a>00278   <a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *io_connection_object = <a class="code" href="../../d1/dbc/appcontype_8c.html#ab3a019a2217375c098345317da123323" title="check if for the given connection data received in a forward_open request a suitable connection is av...">GetIoConnectionForConnectionData</a>(
<a name="l00279"></a>00279     connection_object,
<a name="l00280"></a>00280     extended_error);
<a name="l00281"></a>00281   <span class="keywordflow">if</span>(NULL == io_connection_object) {
<a name="l00282"></a>00282     <span class="keywordflow">return</span> <a class="code" href="../../d6/d52/ciperror_8h.html#a01a2d66a1bdaea7c81e29d4d2530d218a8db04c3335e9735af7d59cf4b7cbdc4b">kCipErrorConnectionFailure</a>;
<a name="l00283"></a>00283   }
<a name="l00284"></a>00284 
<a name="l00285"></a>00285   *extended_error = <a class="code" href="../../df/d03/cipioconnection_8c.html#ac1ef9c10ff4921452840b0de66bb12cf">ProcessProductionInhibitTime</a>(io_connection_object);
<a name="l00286"></a>00286 
<a name="l00287"></a>00287   <span class="keywordflow">if</span>(0 != *extended_error) {
<a name="l00288"></a>00288     <span class="keywordflow">return</span> <a class="code" href="../../d6/d52/ciperror_8h.html#a01a2d66a1bdaea7c81e29d4d2530d218a8db04c3335e9735af7d59cf4b7cbdc4b">kCipErrorConnectionFailure</a>;
<a name="l00289"></a>00289   }
<a name="l00290"></a>00290 
<a name="l00291"></a>00291   <a class="code" href="../../df/d03/cipioconnection_8c.html#ab3282f146a3ea91c90cf14c32206ee8c">SetIoConnectionCallbacks</a>(io_connection_object);
<a name="l00292"></a>00292 
<a name="l00293"></a>00293   <a class="code" href="../../df/d91/cipconnectionobject_8c.html#a65b85bb4b72c902af06e054e24d6292c" title="Generate the ConnectionIDs and set the general configuration parameter in the given connection object...">ConnectionObjectGeneralConfiguration</a>(io_connection_object);
<a name="l00294"></a>00294 
<a name="l00295"></a>00295   <a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#ad6b37311125336c0525f037c107e091a">ConnectionObjectConnectionType</a> originator_to_target_connection_type =
<a name="l00296"></a>00296     <a class="code" href="../../df/d91/cipconnectionobject_8c.html#aa896ebb7d03c6e75027402b3e0d6dc6e">ConnectionObjectGetOToTConnectionType</a>(io_connection_object);
<a name="l00297"></a>00297   <a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#ad6b37311125336c0525f037c107e091a">ConnectionObjectConnectionType</a> target_to_originator_connection_type =
<a name="l00298"></a>00298     <a class="code" href="../../df/d91/cipconnectionobject_8c.html#ad61ad2b2c18480a141e5df346e32be02">ConnectionObjectGetTToOConnectionType</a>(io_connection_object);
<a name="l00299"></a>00299 
<a name="l00301"></a>00301   <a class="code" href="../../dd/d1b/POSIX_2sample__application_2opener__user__conf_8h.html#a7b5e7d71f666ba97788b35be1617c40a">OPENER_ASSERT</a>( !(originator_to_target_connection_type ==
<a name="l00302"></a>00302                    <a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#ad6b37311125336c0525f037c107e091aa489c722263e053ad7efbdb06f1ea7466">kConnectionObjectConnectionTypeNull</a> &amp;&amp;
<a name="l00303"></a>00303                    target_to_originator_connection_type ==
<a name="l00304"></a>00304                    <a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#ad6b37311125336c0525f037c107e091aa489c722263e053ad7efbdb06f1ea7466">kConnectionObjectConnectionTypeNull</a>) );
<a name="l00305"></a>00305 
<a name="l00306"></a>00306   io_connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#adc233577b4d61f10079dad1640bf58b9">consuming_instance</a> = NULL;
<a name="l00307"></a>00307   io_connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#ac13e63588a60dbbbaa40c844e57c8d1f">consumed_connection_path_length</a> = 0;
<a name="l00308"></a>00308   io_connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#ac60f1a2ace4207cfd21d6f1ca0c5449b">producing_instance</a> = NULL;
<a name="l00309"></a>00309   io_connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a253879a49e8decd615b8abdaa6b1d5db">produced_connection_path_length</a> = 0;
<a name="l00310"></a>00310 
<a name="l00311"></a>00311 
<a name="l00312"></a>00312   <span class="comment">/* we don&#39;t need to check for zero as this is handled in the connection path parsing */</span>
<a name="l00313"></a>00313 
<a name="l00314"></a>00314   <span class="keywordflow">if</span> (originator_to_target_connection_type !=
<a name="l00315"></a>00315       <a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#ad6b37311125336c0525f037c107e091aa489c722263e053ad7efbdb06f1ea7466">kConnectionObjectConnectionTypeNull</a>) {                                         <span class="comment">/*setup consumer side*/</span>
<a name="l00316"></a>00316     *extended_error = <a class="code" href="../../df/d03/cipioconnection_8c.html#ac00a39ab755db54e4abf917618ff9849">SetupIoConnectionOriginatorToTargetConnectionPoint</a>(
<a name="l00317"></a>00317       io_connection_object,
<a name="l00318"></a>00318       connection_object);
<a name="l00319"></a>00319     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759a299259d157a6ac077f1c5c8904ceaef8">kConnectionManagerExtendedStatusCodeSuccess</a> != *extended_error) {
<a name="l00320"></a>00320       <span class="keywordflow">return</span> <a class="code" href="../../d6/d52/ciperror_8h.html#a01a2d66a1bdaea7c81e29d4d2530d218a8db04c3335e9735af7d59cf4b7cbdc4b">kCipErrorConnectionFailure</a>;
<a name="l00321"></a>00321     }
<a name="l00322"></a>00322   }
<a name="l00323"></a>00323 
<a name="l00324"></a>00324 
<a name="l00325"></a>00325   <span class="keywordflow">if</span> (target_to_originator_connection_type !=
<a name="l00326"></a>00326       <a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#ad6b37311125336c0525f037c107e091aa489c722263e053ad7efbdb06f1ea7466">kConnectionObjectConnectionTypeNull</a>) {                                         <span class="comment">/*setup producer side*/</span>
<a name="l00327"></a>00327     *extended_error = <a class="code" href="../../df/d03/cipioconnection_8c.html#a4efa3b0cf11b363c8c5f4f8c8070b43f">SetupIoConnectionTargetToOriginatorConnectionPoint</a>(
<a name="l00328"></a>00328       io_connection_object,
<a name="l00329"></a>00329       connection_object);
<a name="l00330"></a>00330     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759a299259d157a6ac077f1c5c8904ceaef8">kConnectionManagerExtendedStatusCodeSuccess</a> != *extended_error) {
<a name="l00331"></a>00331       <span class="keywordflow">return</span> <a class="code" href="../../d6/d52/ciperror_8h.html#a01a2d66a1bdaea7c81e29d4d2530d218a8db04c3335e9735af7d59cf4b7cbdc4b">kCipErrorConnectionFailure</a>;
<a name="l00332"></a>00332     }
<a name="l00333"></a>00333   }
<a name="l00334"></a>00334 
<a name="l00335"></a>00335 
<a name="l00336"></a>00336   <span class="keywordflow">if</span> (NULL != <a class="code" href="../../df/d03/cipioconnection_8c.html#a534c0a24266039f7ced0d36b7c5496bc">g_config_data_buffer</a>) { <span class="comment">/* config data has been sent with this forward open request */</span>
<a name="l00337"></a>00337     *extended_error = <a class="code" href="../../df/d03/cipioconnection_8c.html#a68b99df85d462657b12a854316c168f5">HandleConfigData</a>(io_connection_object);
<a name="l00338"></a>00338     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759a299259d157a6ac077f1c5c8904ceaef8">kConnectionManagerExtendedStatusCodeSuccess</a> != *extended_error) {
<a name="l00339"></a>00339       <span class="keywordflow">return</span> <a class="code" href="../../d6/d52/ciperror_8h.html#a01a2d66a1bdaea7c81e29d4d2530d218a8db04c3335e9735af7d59cf4b7cbdc4b">kCipErrorConnectionFailure</a>;
<a name="l00340"></a>00340     }
<a name="l00341"></a>00341   }
<a name="l00342"></a>00342 
<a name="l00343"></a>00343   eip_status = <a class="code" href="../../df/d03/cipioconnection_8c.html#a53b85bce88b582414fc282c95f5626f4" title="Take the data given in the connection object structure and open the necessary communication channels...">OpenCommunicationChannels</a>(io_connection_object);
<a name="l00344"></a>00344   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709af172c48a50748097201d49b469c75f7a">kEipStatusOk</a> != eip_status) {
<a name="l00345"></a>00345     *extended_error = 0; <span class="comment">/*TODO find out the correct extended error code*/</span>
<a name="l00346"></a>00346     <span class="keywordflow">return</span> eip_status;
<a name="l00347"></a>00347   }
<a name="l00348"></a>00348 
<a name="l00349"></a>00349   <a class="code" href="../../d5/d35/cipconnectionmanager_8c.html#aac2c0397cf54cb8356126c0d71d744ff" title="Insert the given connection object to the list of currently active and managed connections.">AddNewActiveConnection</a>(io_connection_object);
<a name="l00350"></a>00350   <a class="code" href="../../d5/dc5/group__CIP__CALLBACK__API.html#gac9c9ad2c2254b783e7b447bd84eba8c0" title="Inform the application on changes occurred for a connection.">CheckIoConnectionEvent</a>(
<a name="l00351"></a>00351     io_connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a27028c320baa22cd19299de5580da173">consumed_path</a>.<a class="code" href="../../d9/de3/structconnection__path__epath.html#ac5361794a9129b86407bc843e8749038">instance_id</a>,
<a name="l00352"></a>00352     io_connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a8d8986dcd044a68134f9e52f856718ce">produced_path</a>.<a class="code" href="../../d9/de3/structconnection__path__epath.html#ac5361794a9129b86407bc843e8749038">instance_id</a>,
<a name="l00353"></a>00353     <a class="code" href="../../df/d28/ciptypes_8h.html#a1a7498137431124c4dde66e95095c2d2a6516f9d6e660daf124379a38608434e2">kIoConnectionEventOpened</a>);
<a name="l00354"></a>00354   <span class="keywordflow">return</span> eip_status;
<a name="l00355"></a>00355 }
<a name="l00356"></a>00356 
<a name="l00363"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#add645b42730b2cea369523949c6b9745">00363</a> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#add645b42730b2cea369523949c6b9745" title="Open a Point2Point connection dependent on pa_direction.">OpenConsumingPointToPointConnection</a>(
<a name="l00364"></a>00364   <a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *<span class="keyword">const</span> connection_object,
<a name="l00365"></a>00365   <a class="code" href="../../db/d80/structCipCommonPacketFormatData.html" title="A variant of a CPF packet, including item count, one address item, one data item, and two Sockaddr In...">CipCommonPacketFormatData</a> *<span class="keyword">const</span> common_packet_format_data
<a name="l00366"></a>00366   ) {
<a name="l00367"></a>00367 
<a name="l00368"></a>00368   <span class="keywordtype">int</span> j = 0;
<a name="l00369"></a>00369 
<a name="l00370"></a>00370   <span class="keywordflow">if</span> (common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[0].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a> == 0) { <span class="comment">/* it is not used yet */</span>
<a name="l00371"></a>00371     j = 0;
<a name="l00372"></a>00372   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[1].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a> == 0) {
<a name="l00373"></a>00373     j = 1;
<a name="l00374"></a>00374   }
<a name="l00375"></a>00375 
<a name="l00376"></a>00376   <span class="keyword">struct </span>sockaddr_in addr =
<a name="l00377"></a>00377   { .sin_family = AF_INET, .sin_addr.s_addr = INADDR_ANY, .sin_port = htons(
<a name="l00378"></a>00378       <a class="code" href="../../df/d03/cipioconnection_8c.html#a46f1aa5e4d7142036318ba3c9f2707ea">kOpenerEipIoUdpPort</a>) };
<a name="l00379"></a>00379 
<a name="l00380"></a>00380   <a class="code" href="../../d7/d69/typedefs_8h.html#a378b726bef4c65cb2ec1c1cdf1205f52">CipUsint</a> qos_for_socket = <a class="code" href="../../df/d91/cipconnectionobject_8c.html#aeee7026822ffa05ebabab57a0eed1665">ConnectionObjectGetTToOPriority</a>(connection_object);
<a name="l00381"></a>00381   <span class="keywordtype">int</span> socket = <a class="code" href="../../d5/dc5/group__CIP__CALLBACK__API.html#ga5807bcc51621775c9aedbf58d3a7a6d3" title="create a producing or consuming UDP socket">CreateUdpSocket</a>(<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42a922e4c2f521c295287766f9917c9fea7">kUdpCommuncationDirectionConsuming</a>,
<a name="l00382"></a>00382                                &amp;addr,
<a name="l00383"></a>00383                                qos_for_socket);                                            <span class="comment">/* the address is only needed for bind used if consuming */</span>
<a name="l00384"></a>00384   <span class="keywordflow">if</span> (socket == kEipInvalidSocket) {
<a name="l00385"></a>00385     <a class="code" href="../../d1/d1b/trace_8h.html#a48f0d8056c030015f14cf5907315e6bb">OPENER_TRACE_ERR</a>(
<a name="l00386"></a>00386       <span class="stringliteral">&quot;cannot create UDP socket in OpenPointToPointConnection\n&quot;</span>);
<a name="l00387"></a>00387     <span class="keywordflow">return</span> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709a1ac5aa8c4de11fc51d52843b5d173184">kEipStatusError</a>;
<a name="l00388"></a>00388   }
<a name="l00389"></a>00389 
<a name="l00390"></a>00390   connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#ae86f8f5b3ccc7aa691e24d404e051db8">originator_address</a> = addr; <span class="comment">/* store the address of the originator for packet scanning */</span>
<a name="l00391"></a>00391   addr.sin_addr.s_addr = INADDR_ANY; <span class="comment">/* restore the address */</span>
<a name="l00392"></a>00392   connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#aa12a45d71134370c0f3882863840c7cd">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42a922e4c2f521c295287766f9917c9fea7">kUdpCommuncationDirectionConsuming</a>] = socket;
<a name="l00393"></a>00393 
<a name="l00394"></a>00394   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a8933e644c7191ea8f5a22401b2e6a6fa">length</a> = 16;
<a name="l00395"></a>00395   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a> =
<a name="l00396"></a>00396     <a class="code" href="../../d4/d91/group__ENCAP.html#ggafdcff621008b5e305165424c6ac4ea25a93851549b6af1ed796409633e8071623">kCipItemIdSocketAddressInfoOriginatorToTarget</a>;
<a name="l00397"></a>00397 
<a name="l00398"></a>00398   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a3f7a4600643a87742112758468b42146">sin_port</a> = addr.sin_port;
<a name="l00399"></a>00399   <span class="comment">/*TODO should we add our own address here? */</span>
<a name="l00400"></a>00400   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a46921af5bef9ee04546194f8d19d3163">sin_addr</a> = addr.sin_addr
<a name="l00401"></a>00401                                                              .s_addr;
<a name="l00402"></a>00402   memset(common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#abaf556494b9fea3137c6c45522ab9bda">nasin_zero</a>, 0, 8);
<a name="l00403"></a>00403   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a6698e4b44eeaf0795025d0be524b8e8a">sin_family</a> = htons(AF_INET);
<a name="l00404"></a>00404 
<a name="l00405"></a>00405   <span class="keywordflow">return</span> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709af172c48a50748097201d49b469c75f7a">kEipStatusOk</a>;
<a name="l00406"></a>00406 }
<a name="l00407"></a>00407 
<a name="l00408"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#aa3b58fd216ec6712abc29ef84b33006d">00408</a> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#aa3b58fd216ec6712abc29ef84b33006d">OpenProducingPointToPointConnection</a>(
<a name="l00409"></a>00409   <a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *connection_object,
<a name="l00410"></a>00410   <a class="code" href="../../db/d80/structCipCommonPacketFormatData.html" title="A variant of a CPF packet, including item count, one address item, one data item, and two Sockaddr In...">CipCommonPacketFormatData</a> *common_packet_format_data
<a name="l00411"></a>00411   ) {
<a name="l00412"></a>00412   <a class="code" href="../../db/d9c/WIN32_2sample__application_2opener__user__conf_8h.html#adc5174418a78989eb51ef56f622db6e3">in_port_t</a> port = htons(<a class="code" href="../../df/d03/cipioconnection_8c.html#a46f1aa5e4d7142036318ba3c9f2707ea">kOpenerEipIoUdpPort</a>); <span class="comment">/* the default port to be used if no port information is part of the forward open request */</span>
<a name="l00413"></a>00413 
<a name="l00414"></a>00414   <span class="keywordflow">if</span> (<a class="code" href="../../d4/d91/group__ENCAP.html#ggafdcff621008b5e305165424c6ac4ea25aef2e6ffe3e7443b14842d173c7f1e75d">kCipItemIdSocketAddressInfoTargetToOriginator</a>
<a name="l00415"></a>00415       == common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[0].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a>) {
<a name="l00416"></a>00416     port = common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[0].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a3f7a4600643a87742112758468b42146">sin_port</a>;
<a name="l00417"></a>00417   } <span class="keywordflow">else</span> {
<a name="l00418"></a>00418     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d91/group__ENCAP.html#ggafdcff621008b5e305165424c6ac4ea25aef2e6ffe3e7443b14842d173c7f1e75d">kCipItemIdSocketAddressInfoTargetToOriginator</a>
<a name="l00419"></a>00419         == common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[1].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a>) {
<a name="l00420"></a>00420       port = common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[1].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a3f7a4600643a87742112758468b42146">sin_port</a>;
<a name="l00421"></a>00421     }
<a name="l00422"></a>00422   }
<a name="l00423"></a>00423 
<a name="l00424"></a>00424   connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a0f448721c05d130babb37390efbac96d">remote_address</a>.sin_family = AF_INET;
<a name="l00425"></a>00425   connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a0f448721c05d130babb37390efbac96d">remote_address</a>.sin_addr.s_addr = 0; <span class="comment">/* we don&#39;t know the address of the originate will be set in the IApp_CreateUDPSocket */</span>
<a name="l00426"></a>00426   connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a0f448721c05d130babb37390efbac96d">remote_address</a>.sin_port = port;
<a name="l00427"></a>00427 
<a name="l00428"></a>00428   <a class="code" href="../../d7/d69/typedefs_8h.html#a378b726bef4c65cb2ec1c1cdf1205f52">CipUsint</a> qos_for_socket = <a class="code" href="../../df/d91/cipconnectionobject_8c.html#aeee7026822ffa05ebabab57a0eed1665">ConnectionObjectGetTToOPriority</a>(connection_object);
<a name="l00429"></a>00429   <span class="keywordtype">int</span> socket = <a class="code" href="../../d5/dc5/group__CIP__CALLBACK__API.html#ga5807bcc51621775c9aedbf58d3a7a6d3" title="create a producing or consuming UDP socket">CreateUdpSocket</a>(<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>,
<a name="l00430"></a>00430                                &amp;connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a0f448721c05d130babb37390efbac96d">remote_address</a>,
<a name="l00431"></a>00431                                qos_for_socket);                                     <span class="comment">/* the address is only needed for bind used if consuming */</span>
<a name="l00432"></a>00432   <span class="keywordflow">if</span> (socket == kEipInvalidSocket) {
<a name="l00433"></a>00433     <a class="code" href="../../d1/d1b/trace_8h.html#a48f0d8056c030015f14cf5907315e6bb">OPENER_TRACE_ERR</a>(
<a name="l00434"></a>00434       <span class="stringliteral">&quot;cannot create UDP socket in OpenPointToPointConnection\n&quot;</span>);
<a name="l00435"></a>00435     <span class="comment">/* *pa_pnExtendedError = 0x0315; miscellaneous*/</span>
<a name="l00436"></a>00436     <span class="keywordflow">return</span> <a class="code" href="../../d6/d52/ciperror_8h.html#a01a2d66a1bdaea7c81e29d4d2530d218a8db04c3335e9735af7d59cf4b7cbdc4b">kCipErrorConnectionFailure</a>;
<a name="l00437"></a>00437   }
<a name="l00438"></a>00438   connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#aa12a45d71134370c0f3882863840c7cd">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>] = socket;
<a name="l00439"></a>00439 
<a name="l00440"></a>00440   <span class="keywordflow">return</span> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709af172c48a50748097201d49b469c75f7a">kEipStatusOk</a>;
<a name="l00441"></a>00441 }
<a name="l00442"></a>00442 
<a name="l00443"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a5dea6fc1be0ed4ecf5d9e4f932d52106">00443</a> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a5dea6fc1be0ed4ecf5d9e4f932d52106">OpenProducingMulticastConnection</a>(
<a name="l00444"></a>00444   <a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *connection_object,
<a name="l00445"></a>00445   <a class="code" href="../../db/d80/structCipCommonPacketFormatData.html" title="A variant of a CPF packet, including item count, one address item, one data item, and two Sockaddr In...">CipCommonPacketFormatData</a> *common_packet_format_data
<a name="l00446"></a>00446   ) {
<a name="l00447"></a>00447   <a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *existing_connection_object =
<a name="l00448"></a>00448     <a class="code" href="../../d1/dbc/appcontype_8c.html#ac568876f2c5ba2da91a0e62e17e27432" title="Check if there exists already an exclusive owner or listen only connection which produces the input a...">GetExistingProducerMulticastConnection</a>(
<a name="l00449"></a>00449       connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a8d8986dcd044a68134f9e52f856718ce">produced_path</a>.<a class="code" href="../../d9/de3/structconnection__path__epath.html#ac5361794a9129b86407bc843e8749038">instance_id</a>);
<a name="l00450"></a>00450 
<a name="l00451"></a>00451   <span class="keywordtype">int</span> j = 0; <span class="comment">/* allocate an unused sockaddr struct to use */</span>
<a name="l00452"></a>00452   <span class="keywordflow">if</span> (<a class="code" href="../../d4/d91/group__ENCAP.html#gafaae5be8de81c633ea4df46fa8b957e0" title="Data storage for the any CPF data Currently we are single threaded and need only one CPF at the time...">g_common_packet_format_data_item</a>.<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[0].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a> == 0) { <span class="comment">/* it is not used yet */</span>
<a name="l00453"></a>00453     j = 0;
<a name="l00454"></a>00454   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d4/d91/group__ENCAP.html#gafaae5be8de81c633ea4df46fa8b957e0" title="Data storage for the any CPF data Currently we are single threaded and need only one CPF at the time...">g_common_packet_format_data_item</a>.<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[1].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a>
<a name="l00455"></a>00455              == 0) {
<a name="l00456"></a>00456     j = 1;
<a name="l00457"></a>00457   }
<a name="l00458"></a>00458 
<a name="l00459"></a>00459   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a> =
<a name="l00460"></a>00460     <a class="code" href="../../d4/d91/group__ENCAP.html#ggafdcff621008b5e305165424c6ac4ea25aef2e6ffe3e7443b14842d173c7f1e75d">kCipItemIdSocketAddressInfoTargetToOriginator</a>;
<a name="l00461"></a>00461 
<a name="l00462"></a>00462   <span class="keywordflow">if</span> (NULL == existing_connection_object) { <span class="comment">/* we are the first connection producing for the given Input Assembly */</span>
<a name="l00463"></a>00463     <span class="keywordflow">return</span> <a class="code" href="../../df/d03/cipioconnection_8c.html#a9e2ce4666173987646cf60ce3422d7b4">OpenMulticastConnection</a>(<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>,
<a name="l00464"></a>00464                                    connection_object,
<a name="l00465"></a>00465                                    common_packet_format_data);
<a name="l00466"></a>00466   } <span class="keywordflow">else</span> {
<a name="l00467"></a>00467     <span class="comment">/* we need to inform our originator on the correct connection id */</span>
<a name="l00468"></a>00468     connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#ae52d0b09c72bf7ef7c3ec3909198b569">cip_produced_connection_id</a> = existing_connection_object
<a name="l00469"></a>00469                                                     -&gt;
<a name="l00470"></a>00470                                                     cip_produced_connection_id;
<a name="l00471"></a>00471   }
<a name="l00472"></a>00472 
<a name="l00473"></a>00473   <span class="comment">/* we have a connection reuse the data and the socket */</span>
<a name="l00474"></a>00474 
<a name="l00475"></a>00475   <span class="keywordflow">if</span> (<a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#a8fbd6c5533dcc176e91ae9292524d5aba868ab030f24ecf41724bed2fadfe4caa">kConnectionObjectInstanceTypeIOExclusiveOwner</a> ==
<a name="l00476"></a>00476       connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a772a8a668d0b49599ebf8e972443bbca">instance_type</a>) {
<a name="l00477"></a>00477     <span class="comment">/* exclusive owners take the socket and further manage the connection</span>
<a name="l00478"></a>00478 <span class="comment">     * especially in the case of time outs.</span>
<a name="l00479"></a>00479 <span class="comment">     */</span>
<a name="l00480"></a>00480     connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#aa12a45d71134370c0f3882863840c7cd">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>] =
<a name="l00481"></a>00481       existing_connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#aa12a45d71134370c0f3882863840c7cd">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>];
<a name="l00482"></a>00482     existing_connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#aa12a45d71134370c0f3882863840c7cd">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>] =
<a name="l00483"></a>00483       kEipInvalidSocket;
<a name="l00484"></a>00484   } <span class="keywordflow">else</span> { <span class="comment">/* this connection will not produce the data */</span>
<a name="l00485"></a>00485     connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#aa12a45d71134370c0f3882863840c7cd">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>] =
<a name="l00486"></a>00486       kEipInvalidSocket;
<a name="l00487"></a>00487   }
<a name="l00488"></a>00488 
<a name="l00489"></a>00489   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a8933e644c7191ea8f5a22401b2e6a6fa">length</a> = 16;
<a name="l00490"></a>00490 
<a name="l00491"></a>00491   connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a0f448721c05d130babb37390efbac96d">remote_address</a>.sin_family = AF_INET;
<a name="l00492"></a>00492   connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a0f448721c05d130babb37390efbac96d">remote_address</a>.sin_port = common_packet_format_data
<a name="l00493"></a>00493                                                -&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a3f7a4600643a87742112758468b42146">sin_port</a>
<a name="l00494"></a>00494                                                  = htons(<a class="code" href="../../df/d03/cipioconnection_8c.html#a46f1aa5e4d7142036318ba3c9f2707ea">kOpenerEipIoUdpPort</a>);
<a name="l00495"></a>00495   connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a0f448721c05d130babb37390efbac96d">remote_address</a>.sin_addr.s_addr = common_packet_format_data
<a name="l00496"></a>00496                                                       -&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].
<a name="l00497"></a>00497                                                       sin_addr =
<a name="l00498"></a>00498                                                         <a class="code" href="../../dd/d20/ciptcpipinterface_8c.html#a3b13a18a3f6efcb8f2e651676096f4e5" title="#9 The multicast configuration for this device">g_multicast_configuration</a>
<a name="l00499"></a>00499                                                         .
<a name="l00500"></a>00500                                                         starting_multicast_address;
<a name="l00501"></a>00501   memset(common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#abaf556494b9fea3137c6c45522ab9bda">nasin_zero</a>, 0, 8);
<a name="l00502"></a>00502   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a6698e4b44eeaf0795025d0be524b8e8a">sin_family</a> = htons(AF_INET);
<a name="l00503"></a>00503 
<a name="l00504"></a>00504   <span class="keywordflow">return</span> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709af172c48a50748097201d49b469c75f7a">kEipStatusOk</a>;
<a name="l00505"></a>00505 }
<a name="l00506"></a>00506 
<a name="l00514"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a9e2ce4666173987646cf60ce3422d7b4">00514</a> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a9e2ce4666173987646cf60ce3422d7b4">OpenMulticastConnection</a>(
<a name="l00515"></a>00515   <a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42" title="Communication direction of an UDP socket; consuming is receiver, producing is sender.">UdpCommuncationDirection</a> direction,
<a name="l00516"></a>00516   <a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *connection_object,
<a name="l00517"></a>00517   <a class="code" href="../../db/d80/structCipCommonPacketFormatData.html" title="A variant of a CPF packet, including item count, one address item, one data item, and two Sockaddr In...">CipCommonPacketFormatData</a> *common_packet_format_data
<a name="l00518"></a>00518   ) {
<a name="l00519"></a>00519   <span class="keywordtype">int</span> j = -1;
<a name="l00520"></a>00520 
<a name="l00521"></a>00521   <span class="keywordtype">int</span> address_info_item_which_contains_o_to_t = -1;
<a name="l00522"></a>00522   <span class="keywordtype">int</span> address_info_item_which_contains_t_to_o = -1;
<a name="l00523"></a>00523 
<a name="l00524"></a>00524   <span class="keywordflow">if</span>(<a class="code" href="../../d4/d91/group__ENCAP.html#ggafdcff621008b5e305165424c6ac4ea25a93851549b6af1ed796409633e8071623">kCipItemIdSocketAddressInfoOriginatorToTarget</a>
<a name="l00525"></a>00525      == common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[0].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a>) {
<a name="l00526"></a>00526     address_info_item_which_contains_o_to_t = 0;
<a name="l00527"></a>00527   } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../d4/d91/group__ENCAP.html#ggafdcff621008b5e305165424c6ac4ea25a93851549b6af1ed796409633e8071623">kCipItemIdSocketAddressInfoOriginatorToTarget</a>
<a name="l00528"></a>00528             == common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[1].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a>) {
<a name="l00529"></a>00529     address_info_item_which_contains_o_to_t = 1;
<a name="l00530"></a>00530   } <span class="keywordflow">else</span> {
<a name="l00531"></a>00531     <a class="code" href="../../d1/d1b/trace_8h.html#a9a8a4741005c175e598afc162f68982a">OPENER_TRACE_INFO</a>(<span class="stringliteral">&quot;No O-&gt;T Sockaddr info available\n&quot;</span>);
<a name="l00532"></a>00532   }
<a name="l00533"></a>00533 
<a name="l00534"></a>00534   <span class="keywordflow">if</span>(<a class="code" href="../../d4/d91/group__ENCAP.html#ggafdcff621008b5e305165424c6ac4ea25aef2e6ffe3e7443b14842d173c7f1e75d">kCipItemIdSocketAddressInfoTargetToOriginator</a>
<a name="l00535"></a>00535      == common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[0].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a>) {
<a name="l00536"></a>00536     address_info_item_which_contains_t_to_o = 0;
<a name="l00537"></a>00537   } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../d4/d91/group__ENCAP.html#ggafdcff621008b5e305165424c6ac4ea25aef2e6ffe3e7443b14842d173c7f1e75d">kCipItemIdSocketAddressInfoTargetToOriginator</a>
<a name="l00538"></a>00538             == common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[1].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a>) {
<a name="l00539"></a>00539     address_info_item_which_contains_t_to_o = 1;
<a name="l00540"></a>00540   } <span class="keywordflow">else</span> {
<a name="l00541"></a>00541     <a class="code" href="../../d1/d1b/trace_8h.html#a9a8a4741005c175e598afc162f68982a">OPENER_TRACE_INFO</a>(<span class="stringliteral">&quot;No T-&gt;O Sockaddr info available\n&quot;</span>);
<a name="l00542"></a>00542   }
<a name="l00543"></a>00543 
<a name="l00544"></a>00544   <span class="keywordflow">if</span>(<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42a922e4c2f521c295287766f9917c9fea7">kUdpCommuncationDirectionConsuming</a> == direction) {
<a name="l00545"></a>00545     <span class="comment">//OPENER_ASSERT(-1 != address_info_item_which_contains_o_to_t);</span>
<a name="l00546"></a>00546     j = address_info_item_which_contains_o_to_t;
<a name="l00547"></a>00547   }
<a name="l00548"></a>00548 
<a name="l00549"></a>00549   <span class="keywordflow">if</span>(<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a> == direction) {
<a name="l00550"></a>00550     <span class="comment">//OPENER_ASSERT(-1 != address_info_item_which_contains_o_to_t);</span>
<a name="l00551"></a>00551     j = address_info_item_which_contains_t_to_o;
<a name="l00552"></a>00552   }
<a name="l00553"></a>00553 
<a name="l00554"></a>00554   <span class="comment">/*****************/</span>
<a name="l00555"></a>00555 
<a name="l00556"></a>00556   <span class="keywordflow">if</span> (-1 == j) {
<a name="l00557"></a>00557     <a class="code" href="../../d1/d1b/trace_8h.html#a48f0d8056c030015f14cf5907315e6bb">OPENER_TRACE_ERR</a>(
<a name="l00558"></a>00558       <span class="stringliteral">&quot;no suitable addr info item available / O-&gt;T: %d, T-&gt;O: %d, Selector: %d, direction: %d\n&quot;</span>,
<a name="l00559"></a>00559       address_info_item_which_contains_o_to_t,
<a name="l00560"></a>00560       address_info_item_which_contains_t_to_o,
<a name="l00561"></a>00561       j,
<a name="l00562"></a>00562       direction);
<a name="l00563"></a>00563     <span class="keywordflow">return</span> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709a1ac5aa8c4de11fc51d52843b5d173184">kEipStatusError</a>;
<a name="l00564"></a>00564   }
<a name="l00565"></a>00565 
<a name="l00566"></a>00566   <span class="keywordflow">if</span> (<a class="code" href="../../d4/d91/group__ENCAP.html#ggafdcff621008b5e305165424c6ac4ea25aef2e6ffe3e7443b14842d173c7f1e75d">kCipItemIdSocketAddressInfoTargetToOriginator</a> ==
<a name="l00567"></a>00567       common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a>) {                                                  <span class="comment">/* we are using an unused item initialize it with the default multicast address */</span>
<a name="l00568"></a>00568     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a6698e4b44eeaf0795025d0be524b8e8a">sin_family</a> = htons(
<a name="l00569"></a>00569       AF_INET);
<a name="l00570"></a>00570     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a3f7a4600643a87742112758468b42146">sin_port</a> = htons(
<a name="l00571"></a>00571       <a class="code" href="../../df/d03/cipioconnection_8c.html#a46f1aa5e4d7142036318ba3c9f2707ea">kOpenerEipIoUdpPort</a>);
<a name="l00572"></a>00572     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a46921af5bef9ee04546194f8d19d3163">sin_addr</a> =
<a name="l00573"></a>00573       <a class="code" href="../../dd/d20/ciptcpipinterface_8c.html#a3b13a18a3f6efcb8f2e651676096f4e5" title="#9 The multicast configuration for this device">g_multicast_configuration</a>.<a class="code" href="../../db/dd7/structmulticast__address__configuration.html#a983b98b7087072214bc4fc803b938df3">starting_multicast_address</a>;
<a name="l00574"></a>00574     memset(common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#abaf556494b9fea3137c6c45522ab9bda">nasin_zero</a>, 0, 8);
<a name="l00575"></a>00575     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a8933e644c7191ea8f5a22401b2e6a6fa">length</a> = 16;
<a name="l00576"></a>00576   }
<a name="l00577"></a>00577 
<a name="l00578"></a>00578   <span class="keywordflow">if</span> (htons(AF_INET)
<a name="l00579"></a>00579       != common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a6698e4b44eeaf0795025d0be524b8e8a">sin_family</a>) {
<a name="l00580"></a>00580     <a class="code" href="../../d1/d1b/trace_8h.html#a48f0d8056c030015f14cf5907315e6bb">OPENER_TRACE_ERR</a>(
<a name="l00581"></a>00581       <span class="stringliteral">&quot;Sockaddr Info Item with wrong sin family value received\n&quot;</span>);
<a name="l00582"></a>00582     <span class="keywordflow">return</span> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709a1ac5aa8c4de11fc51d52843b5d173184">kEipStatusError</a>;
<a name="l00583"></a>00583   }
<a name="l00584"></a>00584 
<a name="l00585"></a>00585   <span class="comment">/* allocate an unused sockaddr struct to use */</span>
<a name="l00586"></a>00586   <span class="keyword">struct </span>sockaddr_in socket_address = {0};
<a name="l00587"></a>00587   socket_address.sin_family = ntohs(
<a name="l00588"></a>00588     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a6698e4b44eeaf0795025d0be524b8e8a">sin_family</a>);
<a name="l00589"></a>00589   socket_address.sin_addr.s_addr =
<a name="l00590"></a>00590     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a46921af5bef9ee04546194f8d19d3163">sin_addr</a>;
<a name="l00591"></a>00591   socket_address.sin_port = common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j]
<a name="l00592"></a>00592                             .<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#a3f7a4600643a87742112758468b42146">sin_port</a>;
<a name="l00593"></a>00593 
<a name="l00594"></a>00594   <a class="code" href="../../d7/d69/typedefs_8h.html#a378b726bef4c65cb2ec1c1cdf1205f52">CipUsint</a> qos_for_socket = <a class="code" href="../../df/d91/cipconnectionobject_8c.html#aeee7026822ffa05ebabab57a0eed1665">ConnectionObjectGetTToOPriority</a>(connection_object);
<a name="l00595"></a>00595   <span class="keywordtype">int</span> socket = <a class="code" href="../../d5/dc5/group__CIP__CALLBACK__API.html#ga5807bcc51621775c9aedbf58d3a7a6d3" title="create a producing or consuming UDP socket">CreateUdpSocket</a>(direction, &amp;socket_address, qos_for_socket); <span class="comment">/* the address is only needed for bind used if consuming */</span>
<a name="l00596"></a>00596   <span class="keywordflow">if</span> (socket == kEipInvalidSocket) {
<a name="l00597"></a>00597     <a class="code" href="../../d1/d1b/trace_8h.html#a48f0d8056c030015f14cf5907315e6bb">OPENER_TRACE_ERR</a>(<span class="stringliteral">&quot;cannot create UDP socket in OpenMulticastConnection\n&quot;</span>);
<a name="l00598"></a>00598     <span class="keywordflow">return</span> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709a1ac5aa8c4de11fc51d52843b5d173184">kEipStatusError</a>;
<a name="l00599"></a>00599   }
<a name="l00600"></a>00600   connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#aa12a45d71134370c0f3882863840c7cd">socket</a>[direction] = socket;
<a name="l00601"></a>00601 
<a name="l00602"></a>00602   <span class="keywordflow">if</span> (direction == <a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42a922e4c2f521c295287766f9917c9fea7">kUdpCommuncationDirectionConsuming</a>) {
<a name="l00603"></a>00603     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a> =
<a name="l00604"></a>00604       <a class="code" href="../../d4/d91/group__ENCAP.html#ggafdcff621008b5e305165424c6ac4ea25a93851549b6af1ed796409633e8071623">kCipItemIdSocketAddressInfoOriginatorToTarget</a>;
<a name="l00605"></a>00605     connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#ae86f8f5b3ccc7aa691e24d404e051db8">originator_address</a> = socket_address;
<a name="l00606"></a>00606   } <span class="keywordflow">else</span> {
<a name="l00607"></a>00607     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[j].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a> =
<a name="l00608"></a>00608       <a class="code" href="../../d4/d91/group__ENCAP.html#ggafdcff621008b5e305165424c6ac4ea25aef2e6ffe3e7443b14842d173c7f1e75d">kCipItemIdSocketAddressInfoTargetToOriginator</a>;
<a name="l00609"></a>00609     connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a0f448721c05d130babb37390efbac96d">remote_address</a> = socket_address;
<a name="l00610"></a>00610   }
<a name="l00611"></a>00611 
<a name="l00612"></a>00612   <span class="keywordflow">return</span> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709af172c48a50748097201d49b469c75f7a">kEipStatusOk</a>;
<a name="l00613"></a>00613 }
<a name="l00614"></a>00614 
<a name="l00615"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a68b99df85d462657b12a854316c168f5">00615</a> <a class="code" href="../../d7/d69/typedefs_8h.html#ac1b4cfa25b4f5def62f23b455dd395d8">EipUint16</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a68b99df85d462657b12a854316c168f5">HandleConfigData</a>(<a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *connection_object) {
<a name="l00616"></a>00616 
<a name="l00617"></a>00617   <a class="code" href="../../da/d8e/structcip__class.html" title="Class is a subclass of Instance.">CipClass</a> *<span class="keyword">const</span> assembly_class = <a class="code" href="../../d2/dc9/group__CIP__API.html#ga98bd609c80ece316406363575b4a89ea" title="Get a pointer to a CIP object with given class code.">GetCipClass</a>(kCipAssemblyClassCode);
<a name="l00618"></a>00618   <a class="code" href="../../d7/d69/typedefs_8h.html#ac1b4cfa25b4f5def62f23b455dd395d8">EipUint16</a> connection_manager_status = 0;
<a name="l00619"></a>00619   <a class="code" href="../../d5/dc5/structcip__instance.html">CipInstance</a> *config_instance = <a class="code" href="../../d2/dc9/group__CIP__API.html#gaa50395aca91b378c297d6ad919df210e" title="Get a pointer to an instance.">GetCipInstance</a>(
<a name="l00620"></a>00620     assembly_class, connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#af1595add8f6d4e0f5bac19b7918c02ec">configuration_path</a>.<a class="code" href="../../d9/de3/structconnection__path__epath.html#ac5361794a9129b86407bc843e8749038">instance_id</a>);
<a name="l00621"></a>00621 
<a name="l00622"></a>00622   <span class="keywordflow">if</span> (0 != <a class="code" href="../../df/d03/cipioconnection_8c.html#ad20328302a359540d55f48ae36f7237d">g_config_data_length</a>) {
<a name="l00623"></a>00623     <span class="keywordflow">if</span> ( <a class="code" href="../../d1/dbc/appcontype_8c.html#ac869fbefb1f616eaa666fe659c224fe3" title="Check if there is an established connection that uses the same config point.">ConnectionWithSameConfigPointExists</a>(
<a name="l00624"></a>00624            connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#af1595add8f6d4e0f5bac19b7918c02ec">configuration_path</a>.<a class="code" href="../../d9/de3/structconnection__path__epath.html#ac5361794a9129b86407bc843e8749038">instance_id</a>) ) {                                               <span class="comment">/* there is a connected connection with the same config point</span>
<a name="l00625"></a>00625 <span class="comment">                                                                                                                 * we have to have the same data as already present in the config point*/</span>
<a name="l00626"></a>00626       <a class="code" href="../../de/dd7/structCipByteArray.html" title="CIP Byte Array.">CipByteArray</a> *attribute_three = (<a class="code" href="../../de/dd7/structCipByteArray.html" title="CIP Byte Array.">CipByteArray</a> *) <a class="code" href="../../d2/dc9/group__CIP__API.html#ga5a14c8d76acacb09312b709bb0a76265" title="Get a pointer to an instance&#39;s attribute.">GetCipAttribute</a>(
<a name="l00627"></a>00627         config_instance,
<a name="l00628"></a>00628         3)-&gt;<a class="code" href="../../d4/d62/structCipAttributeStruct.html#a859d8bdd91ff42b1ce0ff5f8053d2b40">data</a>;
<a name="l00629"></a>00629       <span class="keywordflow">if</span> (attribute_three-&gt;<a class="code" href="../../de/dd7/structCipByteArray.html#a2fc468bacd1d1300da4286bb838b7f7b">length</a> != <a class="code" href="../../df/d03/cipioconnection_8c.html#ad20328302a359540d55f48ae36f7237d">g_config_data_length</a>) {
<a name="l00630"></a>00630         connection_manager_status =
<a name="l00631"></a>00631           <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759a81369fa2ff6c7f2165f3876c6eac1a03">kConnectionManagerExtendedStatusCodeErrorOwnershipConflict</a>;
<a name="l00632"></a>00632         <a class="code" href="../../d1/d1b/trace_8h.html#a9a8a4741005c175e598afc162f68982a">OPENER_TRACE_INFO</a>(
<a name="l00633"></a>00633           <span class="stringliteral">&quot;Hit an Ownership conflict in cipioconnection.c occurrence 1&quot;</span>);
<a name="l00634"></a>00634       } <span class="keywordflow">else</span> {
<a name="l00635"></a>00635         <span class="comment">/*FIXME check if this is correct */</span>
<a name="l00636"></a>00636         <span class="keywordflow">if</span> ( memcmp(attribute_three-&gt;<a class="code" href="../../de/dd7/structCipByteArray.html#ad1f95b3da0adfd2aeafd5db1d415a6b9">data</a>, <a class="code" href="../../df/d03/cipioconnection_8c.html#a534c0a24266039f7ced0d36b7c5496bc">g_config_data_buffer</a>,
<a name="l00637"></a>00637                     <a class="code" href="../../df/d03/cipioconnection_8c.html#ad20328302a359540d55f48ae36f7237d">g_config_data_length</a>) ) {
<a name="l00638"></a>00638           connection_manager_status =
<a name="l00639"></a>00639             <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759a81369fa2ff6c7f2165f3876c6eac1a03">kConnectionManagerExtendedStatusCodeErrorOwnershipConflict</a>;
<a name="l00640"></a>00640           <a class="code" href="../../d1/d1b/trace_8h.html#a9a8a4741005c175e598afc162f68982a">OPENER_TRACE_INFO</a>(
<a name="l00641"></a>00641             <span class="stringliteral">&quot;Hit an Ownership conflict in cipioconnection.c occurrence 2&quot;</span>);
<a name="l00642"></a>00642         }
<a name="l00643"></a>00643       }
<a name="l00644"></a>00644     } <span class="keywordflow">else</span> {
<a name="l00645"></a>00645       <span class="comment">/* put the data on the configuration assembly object with the current</span>
<a name="l00646"></a>00646 <span class="comment">         design this can be done rather efficiently */</span>
<a name="l00647"></a>00647       <span class="keywordflow">if</span> ( <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709af172c48a50748097201d49b469c75f7a">kEipStatusOk</a>
<a name="l00648"></a>00648            != <a class="code" href="../../df/d2e/cipassembly_8c.html#a5dc25129faf75858c0aeaa88ea8d9490" title="notify an Assembly object that data has been received for it.">NotifyAssemblyConnectedDataReceived</a>(config_instance,
<a name="l00649"></a>00649                                                   <a class="code" href="../../df/d03/cipioconnection_8c.html#a534c0a24266039f7ced0d36b7c5496bc">g_config_data_buffer</a>,
<a name="l00650"></a>00650                                                   <a class="code" href="../../df/d03/cipioconnection_8c.html#ad20328302a359540d55f48ae36f7237d">g_config_data_length</a>) ) {
<a name="l00651"></a>00651         <a class="code" href="../../d1/d1b/trace_8h.html#aa1b39db9477c48695273170aff3c3a7a">OPENER_TRACE_WARN</a>(<span class="stringliteral">&quot;Configuration data was invalid\n&quot;</span>);
<a name="l00652"></a>00652         connection_manager_status =
<a name="l00653"></a>00653           <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#a2c7b6cc102450d2b993391113bd2b759a27cf9777eb05383c79d0a8064f00db90">kConnectionManagerExtendedStatusCodeInvalidConfigurationApplicationPath</a>;
<a name="l00654"></a>00654       }
<a name="l00655"></a>00655     }
<a name="l00656"></a>00656   }
<a name="l00657"></a>00657   <span class="keywordflow">return</span> connection_manager_status;
<a name="l00658"></a>00658 }
<a name="l00659"></a>00659 
<a name="l00660"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a730b410a0cdbc6a456973c0e51568968">00660</a> <span class="keywordtype">void</span> <a class="code" href="../../df/d03/cipioconnection_8c.html#a730b410a0cdbc6a456973c0e51568968">CloseIoConnection</a>(<a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *connection_object) {
<a name="l00661"></a>00661 
<a name="l00662"></a>00662   <a class="code" href="../../d5/dc5/group__CIP__CALLBACK__API.html#gac9c9ad2c2254b783e7b447bd84eba8c0" title="Inform the application on changes occurred for a connection.">CheckIoConnectionEvent</a>(connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a27028c320baa22cd19299de5580da173">consumed_path</a>.<a class="code" href="../../d9/de3/structconnection__path__epath.html#ac5361794a9129b86407bc843e8749038">instance_id</a>,
<a name="l00663"></a>00663                          connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a8d8986dcd044a68134f9e52f856718ce">produced_path</a>.<a class="code" href="../../d9/de3/structconnection__path__epath.html#ac5361794a9129b86407bc843e8749038">instance_id</a>,
<a name="l00664"></a>00664                          <a class="code" href="../../df/d28/ciptypes_8h.html#a1a7498137431124c4dde66e95095c2d2aef7d80152c2d6e1a5e7f64bf51801374">kIoConnectionEventClosed</a>);
<a name="l00665"></a>00665 
<a name="l00666"></a>00666   <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#a8fbd6c5533dcc176e91ae9292524d5aba868ab030f24ecf41724bed2fadfe4caa">kConnectionObjectInstanceTypeIOExclusiveOwner</a> ==
<a name="l00667"></a>00667        <a class="code" href="../../df/d91/cipconnectionobject_8c.html#a64d3a78bd3f520b632b04697bd0b2767">ConnectionObjectGetInstanceType</a>(connection_object)
<a name="l00668"></a>00668        || <a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#a8fbd6c5533dcc176e91ae9292524d5abab018e791efab5611f65151a46a40854c">kConnectionObjectInstanceTypeIOInputOnly</a> ==
<a name="l00669"></a>00669        <a class="code" href="../../df/d91/cipconnectionobject_8c.html#a64d3a78bd3f520b632b04697bd0b2767">ConnectionObjectGetInstanceType</a>(connection_object) ) {
<a name="l00670"></a>00670     <span class="keywordflow">if</span> ( ( <a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#ad6b37311125336c0525f037c107e091aa8f7d20eb5adeb31d45a0bfb62dbefe9b">kConnectionObjectConnectionTypeMulticast</a>
<a name="l00671"></a>00671            == <a class="code" href="../../df/d91/cipconnectionobject_8c.html#ad61ad2b2c18480a141e5df346e32be02">ConnectionObjectGetTToOConnectionType</a>(connection_object) )
<a name="l00672"></a>00672          &amp;&amp; (kEipInvalidSocket
<a name="l00673"></a>00673              != connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#aa12a45d71134370c0f3882863840c7cd">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>]) )
<a name="l00674"></a>00674     {
<a name="l00675"></a>00675       <a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *next_non_control_master_connection =
<a name="l00676"></a>00676         <a class="code" href="../../d1/dbc/appcontype_8c.html#acda34462cc2d60ebb7b48a633bfe3c49" title="check if there exists an producing multicast exclusive owner or listen only connection that should pr...">GetNextNonControlMasterConnection</a>(
<a name="l00677"></a>00677           connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a8d8986dcd044a68134f9e52f856718ce">produced_path</a>.<a class="code" href="../../d9/de3/structconnection__path__epath.html#ac5361794a9129b86407bc843e8749038">instance_id</a>);
<a name="l00678"></a>00678       <span class="keywordflow">if</span> (NULL != next_non_control_master_connection) {
<a name="l00679"></a>00679 
<a name="l00680"></a>00680         <span class="comment">/* Transfer socket ownership */</span>
<a name="l00681"></a>00681         next_non_control_master_connection-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#aa12a45d71134370c0f3882863840c7cd">socket</a>[
<a name="l00682"></a>00682           <a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>] =
<a name="l00683"></a>00683           connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#aa12a45d71134370c0f3882863840c7cd">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>];
<a name="l00684"></a>00684 
<a name="l00685"></a>00685         connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#aa12a45d71134370c0f3882863840c7cd">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>] =
<a name="l00686"></a>00686           kEipInvalidSocket;
<a name="l00687"></a>00687         <span class="comment">/* End */</span>
<a name="l00688"></a>00688 
<a name="l00689"></a>00689         memcpy( &amp;(next_non_control_master_connection-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a0f448721c05d130babb37390efbac96d">remote_address</a>),
<a name="l00690"></a>00690                 &amp;(connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a0f448721c05d130babb37390efbac96d">remote_address</a>),
<a name="l00691"></a>00691                 <span class="keyword">sizeof</span>(next_non_control_master_connection-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a0f448721c05d130babb37390efbac96d">remote_address</a>) );
<a name="l00692"></a>00692         next_non_control_master_connection-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a2a01fa4a474e882c0884a7122c1a5834">eip_level_sequence_count_producing</a>
<a name="l00693"></a>00693           =
<a name="l00694"></a>00694             connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a2a01fa4a474e882c0884a7122c1a5834">eip_level_sequence_count_producing</a>;
<a name="l00695"></a>00695         next_non_control_master_connection-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#adb77c52191a28697c2b7063a8f630522">sequence_count_producing</a> =
<a name="l00696"></a>00696           connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#adb77c52191a28697c2b7063a8f630522">sequence_count_producing</a>;
<a name="l00697"></a>00697 <span class="comment">//        CloseUdpSocket(connection_object-&gt;socket[</span>
<a name="l00698"></a>00698 <span class="comment">//                         kUdpCommuncationDirectionProducing]);</span>
<a name="l00699"></a>00699         next_non_control_master_connection-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#ac4b956f5790d2a6e6a825be1c85e378d">transmission_trigger_timer</a> =
<a name="l00700"></a>00700           connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#ac4b956f5790d2a6e6a825be1c85e378d">transmission_trigger_timer</a>;
<a name="l00701"></a>00701       } <span class="keywordflow">else</span> { <span class="comment">/* this was the last master connection close all listen only connections listening on the port */</span>
<a name="l00702"></a>00702         <a class="code" href="../../d1/dbc/appcontype_8c.html#a1181149fe4f853e43552e0b50e2f4d23" title="Close all connection producing the same input and have the same type (i.e., listen only or input only...">CloseAllConnectionsForInputWithSameType</a>(
<a name="l00703"></a>00703           connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a8d8986dcd044a68134f9e52f856718ce">produced_path</a>.<a class="code" href="../../d9/de3/structconnection__path__epath.html#ac5361794a9129b86407bc843e8749038">instance_id</a>,
<a name="l00704"></a>00704           <a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#a8fbd6c5533dcc176e91ae9292524d5aba798ef4c0d84ae03f5082185fb84f2eca">kConnectionObjectInstanceTypeIOListenOnly</a>);
<a name="l00705"></a>00705       }
<a name="l00706"></a>00706     }
<a name="l00707"></a>00707   }
<a name="l00708"></a>00708 
<a name="l00709"></a>00709   <a class="code" href="../../df/d03/cipioconnection_8c.html#a62fc61ed294b1d1543960582f0071b22" title="close the communication channels of the given connection and remove it from the active connections li...">CloseCommunicationChannelsAndRemoveFromActiveConnectionsList</a>(
<a name="l00710"></a>00710     connection_object);
<a name="l00711"></a>00711 }
<a name="l00712"></a>00712 
<a name="l00713"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a7e4923f4b027d489d9933b52f6fd7007">00713</a> <span class="keywordtype">void</span> <a class="code" href="../../df/d03/cipioconnection_8c.html#a7e4923f4b027d489d9933b52f6fd7007">HandleIoConnectionTimeOut</a>(<a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *connection_object) {
<a name="l00714"></a>00714   <a class="code" href="../../d5/dc5/group__CIP__CALLBACK__API.html#gac9c9ad2c2254b783e7b447bd84eba8c0" title="Inform the application on changes occurred for a connection.">CheckIoConnectionEvent</a>(connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a8d8986dcd044a68134f9e52f856718ce">produced_path</a>.<a class="code" href="../../d9/de3/structconnection__path__epath.html#ac5361794a9129b86407bc843e8749038">instance_id</a>,
<a name="l00715"></a>00715                          connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a27028c320baa22cd19299de5580da173">consumed_path</a>.<a class="code" href="../../d9/de3/structconnection__path__epath.html#ac5361794a9129b86407bc843e8749038">instance_id</a>,
<a name="l00716"></a>00716                          <a class="code" href="../../df/d28/ciptypes_8h.html#a1a7498137431124c4dde66e95095c2d2a91f5cbaf05e3e1e95b9c262a851ae931">kIoConnectionEventTimedOut</a>);
<a name="l00717"></a>00717 
<a name="l00718"></a>00718   <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#ad6b37311125336c0525f037c107e091aa8f7d20eb5adeb31d45a0bfb62dbefe9b">kConnectionObjectConnectionTypeMulticast</a>
<a name="l00719"></a>00719        == <a class="code" href="../../df/d91/cipconnectionobject_8c.html#ad61ad2b2c18480a141e5df346e32be02">ConnectionObjectGetTToOConnectionType</a>(connection_object) ) {
<a name="l00720"></a>00720     <span class="keywordflow">switch</span> (connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a772a8a668d0b49599ebf8e972443bbca">instance_type</a>) {
<a name="l00721"></a>00721       <span class="keywordflow">case</span> <a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#a8fbd6c5533dcc176e91ae9292524d5aba868ab030f24ecf41724bed2fadfe4caa">kConnectionObjectInstanceTypeIOExclusiveOwner</a>:
<a name="l00722"></a>00722         <a class="code" href="../../d1/dbc/appcontype_8c.html#a1181149fe4f853e43552e0b50e2f4d23" title="Close all connection producing the same input and have the same type (i.e., listen only or input only...">CloseAllConnectionsForInputWithSameType</a>(
<a name="l00723"></a>00723           connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a8d8986dcd044a68134f9e52f856718ce">produced_path</a>.<a class="code" href="../../d9/de3/structconnection__path__epath.html#ac5361794a9129b86407bc843e8749038">instance_id</a>,
<a name="l00724"></a>00724           <a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#a8fbd6c5533dcc176e91ae9292524d5abab018e791efab5611f65151a46a40854c">kConnectionObjectInstanceTypeIOInputOnly</a>);
<a name="l00725"></a>00725         <a class="code" href="../../d1/dbc/appcontype_8c.html#a1181149fe4f853e43552e0b50e2f4d23" title="Close all connection producing the same input and have the same type (i.e., listen only or input only...">CloseAllConnectionsForInputWithSameType</a>(
<a name="l00726"></a>00726           connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a8d8986dcd044a68134f9e52f856718ce">produced_path</a>.<a class="code" href="../../d9/de3/structconnection__path__epath.html#ac5361794a9129b86407bc843e8749038">instance_id</a>,
<a name="l00727"></a>00727           <a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#a8fbd6c5533dcc176e91ae9292524d5aba798ef4c0d84ae03f5082185fb84f2eca">kConnectionObjectInstanceTypeIOListenOnly</a>);
<a name="l00728"></a>00728         <span class="keywordflow">break</span>;
<a name="l00729"></a>00729       <span class="keywordflow">case</span> <a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#a8fbd6c5533dcc176e91ae9292524d5abab018e791efab5611f65151a46a40854c">kConnectionObjectInstanceTypeIOInputOnly</a>:
<a name="l00730"></a>00730         <span class="keywordflow">if</span> (kEipInvalidSocket
<a name="l00731"></a>00731             != connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#aa12a45d71134370c0f3882863840c7cd">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>]) { <span class="comment">/* we are the controlling input only connection find a new controller*/</span>
<a name="l00732"></a>00732           <a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *next_non_control_master_connection =
<a name="l00733"></a>00733             <a class="code" href="../../d1/dbc/appcontype_8c.html#acda34462cc2d60ebb7b48a633bfe3c49" title="check if there exists an producing multicast exclusive owner or listen only connection that should pr...">GetNextNonControlMasterConnection</a>(
<a name="l00734"></a>00734               connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a8d8986dcd044a68134f9e52f856718ce">produced_path</a>.<a class="code" href="../../d9/de3/structconnection__path__epath.html#ac5361794a9129b86407bc843e8749038">instance_id</a>);
<a name="l00735"></a>00735           <span class="keywordflow">if</span> (NULL != next_non_control_master_connection) {
<a name="l00736"></a>00736             next_non_control_master_connection-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#aa12a45d71134370c0f3882863840c7cd">socket</a>[
<a name="l00737"></a>00737               <a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>] =
<a name="l00738"></a>00738               connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#aa12a45d71134370c0f3882863840c7cd">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>];
<a name="l00739"></a>00739             connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#aa12a45d71134370c0f3882863840c7cd">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>] =
<a name="l00740"></a>00740               kEipInvalidSocket;
<a name="l00741"></a>00741             next_non_control_master_connection-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#ac4b956f5790d2a6e6a825be1c85e378d">transmission_trigger_timer</a> =
<a name="l00742"></a>00742               connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#ac4b956f5790d2a6e6a825be1c85e378d">transmission_trigger_timer</a>;
<a name="l00743"></a>00743           } <span class="keywordflow">else</span> { <span class="comment">/* this was the last master connection close all listen only connections listening on the port */</span>
<a name="l00744"></a>00744             <a class="code" href="../../d1/dbc/appcontype_8c.html#a1181149fe4f853e43552e0b50e2f4d23" title="Close all connection producing the same input and have the same type (i.e., listen only or input only...">CloseAllConnectionsForInputWithSameType</a>(
<a name="l00745"></a>00745               connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a8d8986dcd044a68134f9e52f856718ce">produced_path</a>.<a class="code" href="../../d9/de3/structconnection__path__epath.html#ac5361794a9129b86407bc843e8749038">instance_id</a>,
<a name="l00746"></a>00746               <a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#a8fbd6c5533dcc176e91ae9292524d5aba798ef4c0d84ae03f5082185fb84f2eca">kConnectionObjectInstanceTypeIOListenOnly</a>);
<a name="l00747"></a>00747           }
<a name="l00748"></a>00748         }
<a name="l00749"></a>00749         <span class="keywordflow">break</span>;
<a name="l00750"></a>00750       <span class="keywordflow">default</span>:
<a name="l00751"></a>00751         <span class="keywordflow">break</span>;
<a name="l00752"></a>00752     }
<a name="l00753"></a>00753   }
<a name="l00754"></a>00754 
<a name="l00755"></a>00755   <a class="code" href="../../dd/d1b/POSIX_2sample__application_2opener__user__conf_8h.html#a7b5e7d71f666ba97788b35be1617c40a">OPENER_ASSERT</a>(NULL != connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#aa1cbdb9fe8b98c23e728f846a8b166a4">connection_close_function</a>);
<a name="l00756"></a>00756   connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#aa1cbdb9fe8b98c23e728f846a8b166a4">connection_close_function</a>(connection_object);
<a name="l00757"></a>00757 }
<a name="l00758"></a>00758 
<a name="l00759"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a20f1bc1c4cc4470cf371f94d51814de2">00759</a> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a20f1bc1c4cc4470cf371f94d51814de2" title="Send the data from the produced CIP Object of the connection via the socket of the connection object ...">SendConnectedData</a>(<a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *connection_object) {
<a name="l00760"></a>00760 
<a name="l00761"></a>00761   <span class="comment">/* TODO think of adding an own send buffer to each connection object in order to preset up the whole message on connection opening and just change the variable data items e.g., sequence number */</span>
<a name="l00762"></a>00762 
<a name="l00763"></a>00763   <a class="code" href="../../db/d80/structCipCommonPacketFormatData.html" title="A variant of a CPF packet, including item count, one address item, one data item, and two Sockaddr In...">CipCommonPacketFormatData</a> *common_packet_format_data =
<a name="l00764"></a>00764     &amp;<a class="code" href="../../d4/d91/group__ENCAP.html#gafaae5be8de81c633ea4df46fa8b957e0" title="Data storage for the any CPF data Currently we are single threaded and need only one CPF at the time...">g_common_packet_format_data_item</a>;                                                      <span class="comment">/* TODO think on adding a CPF data item to the S_CIP_ConnectionObject in order to remove the code here or even better allocate memory in the connection object for storing the message to send and just change the application data*/</span>
<a name="l00765"></a>00765 
<a name="l00766"></a>00766   connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a2a01fa4a474e882c0884a7122c1a5834">eip_level_sequence_count_producing</a>++;
<a name="l00767"></a>00767 
<a name="l00768"></a>00768   <span class="comment">/* assembleCPFData */</span>
<a name="l00769"></a>00769   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a7ff1108c27f9ebe1d69305311c6b234b">item_count</a> = 2;
<a name="l00770"></a>00770   <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#a7d9579ba2ab49ebf08a1e8b124f7c68fa848be73a997600d2bfdac37d0520dfc0">kConnectionObjectTransportClassTriggerTransportClass0</a> !=
<a name="l00771"></a>00771        <a class="code" href="../../df/d91/cipconnectionobject_8c.html#a0f3d8e6f21712dbef3fb2e1da42f35ba">ConnectionObjectGetTransportClassTriggerTransportClass</a>(connection_object) )
<a name="l00772"></a>00772   {                                                                                <span class="comment">/* use Sequenced Address Items if not Connection Class 0 */</span>
<a name="l00773"></a>00773     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a6f7f7299bfdc600609c9b9f8fc55ac5b">address_item</a>.<a class="code" href="../../d3/d56/structAddressItem.html#a9b3cf54385b7e3db0c41d4d394c2d465">type_id</a> =
<a name="l00774"></a>00774       <a class="code" href="../../d4/d91/group__ENCAP.html#ggafdcff621008b5e305165424c6ac4ea25a21abefabf9f64dba055671507015f2b1">kCipItemIdSequencedAddressItem</a>;
<a name="l00775"></a>00775     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a6f7f7299bfdc600609c9b9f8fc55ac5b">address_item</a>.<a class="code" href="../../d3/d56/structAddressItem.html#a8651f8610143cd0ef830abdc1fcf00b2">length</a> = 8;
<a name="l00776"></a>00776     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a6f7f7299bfdc600609c9b9f8fc55ac5b">address_item</a>.<a class="code" href="../../d3/d56/structAddressItem.html#ae405cdded64b36b5bbad607ea251865a">data</a>.<a class="code" href="../../d9/da2/structAddressData.html#a41d4480ab2d89c04cd9211586be88ba5">sequence_number</a> =
<a name="l00777"></a>00777       connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a2a01fa4a474e882c0884a7122c1a5834">eip_level_sequence_count_producing</a>;
<a name="l00778"></a>00778   } <span class="keywordflow">else</span> {
<a name="l00779"></a>00779     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a6f7f7299bfdc600609c9b9f8fc55ac5b">address_item</a>.<a class="code" href="../../d3/d56/structAddressItem.html#a9b3cf54385b7e3db0c41d4d394c2d465">type_id</a> =
<a name="l00780"></a>00780       <a class="code" href="../../d4/d91/group__ENCAP.html#ggafdcff621008b5e305165424c6ac4ea25a0adf8007a319941f3aaa7d9624025c0f">kCipItemIdConnectionAddress</a>;
<a name="l00781"></a>00781     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a6f7f7299bfdc600609c9b9f8fc55ac5b">address_item</a>.<a class="code" href="../../d3/d56/structAddressItem.html#a8651f8610143cd0ef830abdc1fcf00b2">length</a> = 4;
<a name="l00782"></a>00782 
<a name="l00783"></a>00783   }
<a name="l00784"></a>00784   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a6f7f7299bfdc600609c9b9f8fc55ac5b">address_item</a>.<a class="code" href="../../d3/d56/structAddressItem.html#ae405cdded64b36b5bbad607ea251865a">data</a>.<a class="code" href="../../d9/da2/structAddressData.html#a955e0fc2a462a58b78f0da83df66a307">connection_identifier</a> =
<a name="l00785"></a>00785     connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#ae52d0b09c72bf7ef7c3ec3909198b569">cip_produced_connection_id</a>;
<a name="l00786"></a>00786 
<a name="l00787"></a>00787   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a054b7138d1a6837b9ade41b17635bc96">data_item</a>.<a class="code" href="../../de/d71/structDataItem.html#acf4b53bdfe8766830d313e9c7e1cf5dc">type_id</a> = <a class="code" href="../../d4/d91/group__ENCAP.html#ggafdcff621008b5e305165424c6ac4ea25a8761662aa0838fb723f8696e9ea4e217">kCipItemIdConnectedDataItem</a>;
<a name="l00788"></a>00788 
<a name="l00789"></a>00789   <a class="code" href="../../de/dd7/structCipByteArray.html" title="CIP Byte Array.">CipByteArray</a> *producing_instance_attributes =
<a name="l00790"></a>00790     (<a class="code" href="../../de/dd7/structCipByteArray.html" title="CIP Byte Array.">CipByteArray</a> *) connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#ac60f1a2ace4207cfd21d6f1ca0c5449b">producing_instance</a>-&gt;<a class="code" href="../../d5/dc5/structcip__instance.html#ada5c4109b95cb6635f4aa32a2e6d74bf">attributes</a>-&gt;<a class="code" href="../../d4/d62/structCipAttributeStruct.html#a859d8bdd91ff42b1ce0ff5f8053d2b40">data</a>;
<a name="l00791"></a>00791   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a054b7138d1a6837b9ade41b17635bc96">data_item</a>.<a class="code" href="../../de/d71/structDataItem.html#a70de504e7692ab2c73be4c96911c9b05">length</a> = 0;
<a name="l00792"></a>00792 
<a name="l00793"></a>00793   <span class="comment">/* notify the application that data will be sent immediately after the call */</span>
<a name="l00794"></a>00794   if ( <a class="code" href="../../d5/dc5/group__CIP__CALLBACK__API.html#ga098272a8ae10facf3086c5c82a0080db" title="Inform the application that the data of an assembly object will be sent.">BeforeAssemblyDataSend</a>(connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#ac60f1a2ace4207cfd21d6f1ca0c5449b">producing_instance</a>) ) {
<a name="l00795"></a>00795     <span class="comment">/* the data has changed increase sequence counter */</span>
<a name="l00796"></a>00796     connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#adb77c52191a28697c2b7063a8f630522">sequence_count_producing</a>++;
<a name="l00797"></a>00797   }
<a name="l00798"></a>00798 
<a name="l00799"></a>00799   <span class="comment">/* set AddressInfo Items to invalid Type */</span>
<a name="l00800"></a>00800   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[0].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a> = 0;
<a name="l00801"></a>00801   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#afc2883222efe7445cb7836d5da872f54">address_info_item</a>[1].<a class="code" href="../../dc/d3c/structSocketAddressInfoItem.html#ad71289b55ab0ff6a4382af44afaccca2">type_id</a> = 0;
<a name="l00802"></a>00802 
<a name="l00803"></a>00803   <a class="code" href="../../d7/d69/typedefs_8h.html#ac1b4cfa25b4f5def62f23b455dd395d8">EipUint16</a> reply_length = <a class="code" href="../../d4/d91/group__ENCAP.html#gad61fa4f84989cf27086d57557ad552c4">AssembleIOMessage</a>(common_packet_format_data,
<a name="l00804"></a>00804                                              &amp;<a class="code" href="../../d2/d3d/cipcommon_8c.html#a5bd888b31f309543df6dc57652d2ac48">g_message_data_reply_buffer</a>[0]);
<a name="l00805"></a>00805 
<a name="l00806"></a>00806   <a class="code" href="../../d7/d69/typedefs_8h.html#aa0c108ee762a27720919a4634643040e">EipUint8</a> *message_data_reply_buffer =
<a name="l00807"></a>00807     &amp;<a class="code" href="../../d2/d3d/cipcommon_8c.html#a5bd888b31f309543df6dc57652d2ac48">g_message_data_reply_buffer</a>[reply_length - 2];
<a name="l00808"></a>00808   common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a054b7138d1a6837b9ade41b17635bc96">data_item</a>.<a class="code" href="../../de/d71/structDataItem.html#a70de504e7692ab2c73be4c96911c9b05">length</a> = producing_instance_attributes
<a name="l00809"></a>00809                                                 -&gt;<a class="code" href="../../de/dd7/structCipByteArray.html#a2fc468bacd1d1300da4286bb838b7f7b">length</a>;
<a name="l00810"></a>00810   <span class="keywordflow">if</span> (kOpenerProducedDataHasRunIdleHeader) {
<a name="l00811"></a>00811     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a054b7138d1a6837b9ade41b17635bc96">data_item</a>.<a class="code" href="../../de/d71/structDataItem.html#a70de504e7692ab2c73be4c96911c9b05">length</a> += 4;
<a name="l00812"></a>00812   }
<a name="l00813"></a>00813 
<a name="l00814"></a>00814   <span class="keywordflow">if</span> (<a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#a7d9579ba2ab49ebf08a1e8b124f7c68fa3985efbf81d9660d0969a318d03fe3f6">kConnectionObjectTransportClassTriggerTransportClass1</a> ==
<a name="l00815"></a>00815       <a class="code" href="../../df/d91/cipconnectionobject_8c.html#a0f3d8e6f21712dbef3fb2e1da42f35ba">ConnectionObjectGetTransportClassTriggerTransportClass</a>(connection_object) )
<a name="l00816"></a>00816   {
<a name="l00817"></a>00817     common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a054b7138d1a6837b9ade41b17635bc96">data_item</a>.<a class="code" href="../../de/d71/structDataItem.html#a70de504e7692ab2c73be4c96911c9b05">length</a> += 2;
<a name="l00818"></a>00818     <a class="code" href="../../d4/d91/group__ENCAP.html#gae689aac2a85bf49fb356ec94c8800799" title="converts UINT16 data from host to little endian an writes it to buffer.">AddIntToMessage</a>(common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a054b7138d1a6837b9ade41b17635bc96">data_item</a>.<a class="code" href="../../de/d71/structDataItem.html#a70de504e7692ab2c73be4c96911c9b05">length</a>,
<a name="l00819"></a>00819                     &amp;message_data_reply_buffer);
<a name="l00820"></a>00820     <a class="code" href="../../d4/d91/group__ENCAP.html#gae689aac2a85bf49fb356ec94c8800799" title="converts UINT16 data from host to little endian an writes it to buffer.">AddIntToMessage</a>(connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#adb77c52191a28697c2b7063a8f630522">sequence_count_producing</a>,
<a name="l00821"></a>00821                     &amp;message_data_reply_buffer);
<a name="l00822"></a>00822   } <span class="keywordflow">else</span> {
<a name="l00823"></a>00823     <a class="code" href="../../d4/d91/group__ENCAP.html#gae689aac2a85bf49fb356ec94c8800799" title="converts UINT16 data from host to little endian an writes it to buffer.">AddIntToMessage</a>(common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a054b7138d1a6837b9ade41b17635bc96">data_item</a>.<a class="code" href="../../de/d71/structDataItem.html#a70de504e7692ab2c73be4c96911c9b05">length</a>,
<a name="l00824"></a>00824                     &amp;message_data_reply_buffer);
<a name="l00825"></a>00825   }
<a name="l00826"></a>00826 
<a name="l00827"></a>00827   <span class="keywordflow">if</span> (kOpenerProducedDataHasRunIdleHeader) {
<a name="l00828"></a>00828     <a class="code" href="../../d4/d91/group__ENCAP.html#gaafc3c9e3ff582c9b7e438ae2b1fdf822" title="Converts UINT32 data from host to little endian and writes it to buffer.">AddDintToMessage</a>( <a class="code" href="../../df/d03/cipioconnection_8c.html#a4901ec04ad1ac886626e556c60f12196">g_run_idle_state</a>, &amp;(message_data_reply_buffer) );
<a name="l00829"></a>00829   }
<a name="l00830"></a>00830 
<a name="l00831"></a>00831   memcpy(message_data_reply_buffer, producing_instance_attributes-&gt;<a class="code" href="../../de/dd7/structCipByteArray.html#ad1f95b3da0adfd2aeafd5db1d415a6b9">data</a>,
<a name="l00832"></a>00832          producing_instance_attributes-&gt;<a class="code" href="../../de/dd7/structCipByteArray.html#a2fc468bacd1d1300da4286bb838b7f7b">length</a>);
<a name="l00833"></a>00833 
<a name="l00834"></a>00834   reply_length += common_packet_format_data-&gt;<a class="code" href="../../db/d80/structCipCommonPacketFormatData.html#a054b7138d1a6837b9ade41b17635bc96">data_item</a>.<a class="code" href="../../de/d71/structDataItem.html#a70de504e7692ab2c73be4c96911c9b05">length</a>;
<a name="l00835"></a>00835 
<a name="l00836"></a>00836   <span class="keywordflow">return</span> <a class="code" href="../../d5/dc5/group__CIP__CALLBACK__API.html#gad1d5f56b277bf8b4ffc431e5b0523518" title="create a producing or consuming UDP socket">SendUdpData</a>(
<a name="l00837"></a>00837     &amp;connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#a0f448721c05d130babb37390efbac96d">remote_address</a>,
<a name="l00838"></a>00838     connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#aa12a45d71134370c0f3882863840c7cd">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>],
<a name="l00839"></a>00839     &amp;<a class="code" href="../../d2/d3d/cipcommon_8c.html#a5bd888b31f309543df6dc57652d2ac48">g_message_data_reply_buffer</a>[0], reply_length);
<a name="l00840"></a>00840 }
<a name="l00841"></a>00841 
<a name="l00842"></a><a class="code" href="../../df/d03/cipioconnection_8c.html#a73bfd5fa3bc96e11219d0b24d70b88c7">00842</a> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a73bfd5fa3bc96e11219d0b24d70b88c7">HandleReceivedIoConnectionData</a>(
<a name="l00843"></a>00843   <a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *connection_object,
<a name="l00844"></a>00844   <span class="keyword">const</span> <a class="code" href="../../d7/d69/typedefs_8h.html#aa0c108ee762a27720919a4634643040e">EipUint8</a> *data,
<a name="l00845"></a>00845   <a class="code" href="../../d7/d69/typedefs_8h.html#ac1b4cfa25b4f5def62f23b455dd395d8">EipUint16</a> data_length
<a name="l00846"></a>00846   ) {
<a name="l00847"></a>00847 
<a name="l00848"></a>00848   <span class="comment">/* check class 1 sequence number*/</span>
<a name="l00849"></a>00849   <span class="keywordflow">if</span> (<a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#a7d9579ba2ab49ebf08a1e8b124f7c68fa3985efbf81d9660d0969a318d03fe3f6">kConnectionObjectTransportClassTriggerTransportClass1</a> ==
<a name="l00850"></a>00850       <a class="code" href="../../df/d91/cipconnectionobject_8c.html#a0f3d8e6f21712dbef3fb2e1da42f35ba">ConnectionObjectGetTransportClassTriggerTransportClass</a>(connection_object) )
<a name="l00851"></a>00851   {
<a name="l00852"></a>00852     <a class="code" href="../../d7/d69/typedefs_8h.html#ac1b4cfa25b4f5def62f23b455dd395d8">EipUint16</a> sequence_buffer = <a class="code" href="../../d4/d91/group__ENCAP.html#ga70322f970709ca9c9a1a1d474cfe2302" title="Reads EIP_UINT16 from *buffer and converts little endian to host.">GetIntFromMessage</a>( &amp;(data) );
<a name="l00853"></a>00853     <span class="keywordflow">if</span> ( <a class="code" href="../../d2/da3/cipconnectionmanager_8h.html#aa90301ce80009301ef74637f50a79e69" title="similar macros for comparing 16 bit sequence numbers  SEQ_LEQ16(a, b) Checks if sequence number a is ...">SEQ_LEQ16</a>(sequence_buffer,
<a name="l00854"></a>00854                    connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#ad768fd9cfb97fcc4f7f7d01cdb67b24f">sequence_count_consuming</a>) ) {
<a name="l00855"></a>00855       <span class="keywordflow">return</span> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709af172c48a50748097201d49b469c75f7a">kEipStatusOk</a>; <span class="comment">/* no new data for the assembly */</span>
<a name="l00856"></a>00856     }
<a name="l00857"></a>00857     connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#ad768fd9cfb97fcc4f7f7d01cdb67b24f">sequence_count_consuming</a> = sequence_buffer;
<a name="l00858"></a>00858     data_length -= 2;
<a name="l00859"></a>00859   }
<a name="l00860"></a>00860 
<a name="l00861"></a>00861   <span class="keywordflow">if</span> (data_length &gt; 0) {
<a name="l00862"></a>00862     <span class="comment">/* we have no heartbeat connection */</span>
<a name="l00863"></a>00863     <span class="keywordflow">if</span> (kOpenerConsumedDataHasRunIdleHeader) {
<a name="l00864"></a>00864       <a class="code" href="../../d7/d69/typedefs_8h.html#abf2dd49262551294eb990ef8746a2767">EipUint32</a> nRunIdleBuf = <a class="code" href="../../d4/d91/group__ENCAP.html#ga668f92389ee06510864585b97955f6f8" title="Reads EIP_UINT32 from *buffer and converts little endian to host.">GetDintFromMessage</a>( &amp;(data) );
<a name="l00865"></a>00865       <span class="keywordflow">if</span> (<a class="code" href="../../df/d03/cipioconnection_8c.html#a4901ec04ad1ac886626e556c60f12196">g_run_idle_state</a> != nRunIdleBuf) {
<a name="l00866"></a>00866         <a class="code" href="../../d5/dc5/group__CIP__CALLBACK__API.html#ga63bf35df0c11815a8a59d8a68ac4b569" title="Inform the application that the Run/Idle State has been changed by the originator.">RunIdleChanged</a>(nRunIdleBuf);
<a name="l00867"></a>00867       }
<a name="l00868"></a>00868       <a class="code" href="../../df/d03/cipioconnection_8c.html#a4901ec04ad1ac886626e556c60f12196">g_run_idle_state</a> = nRunIdleBuf;
<a name="l00869"></a>00869       data_length -= 4;
<a name="l00870"></a>00870     }
<a name="l00871"></a>00871 
<a name="l00872"></a>00872     <span class="keywordflow">if</span> (<a class="code" href="../../df/d2e/cipassembly_8c.html#a5dc25129faf75858c0aeaa88ea8d9490" title="notify an Assembly object that data has been received for it.">NotifyAssemblyConnectedDataReceived</a>(
<a name="l00873"></a>00873           connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#adc233577b4d61f10079dad1640bf58b9">consuming_instance</a>, (<a class="code" href="../../d7/d69/typedefs_8h.html#aa0c108ee762a27720919a4634643040e">EipUint8</a> *<span class="keyword">const</span>)data,
<a name="l00874"></a>00874           data_length) != 0) {
<a name="l00875"></a>00875       <span class="keywordflow">return</span> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709a1ac5aa8c4de11fc51d52843b5d173184">kEipStatusError</a>;
<a name="l00876"></a>00876     }
<a name="l00877"></a>00877   }
<a name="l00878"></a>00878   <span class="keywordflow">return</span> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709af172c48a50748097201d49b469c75f7a">kEipStatusOk</a>;
<a name="l00879"></a>00879 }
<a name="l00880"></a>00880 
<a name="l00881"></a><a class="code" href="../../de/d45/cipioconnection_8h.html#a53b85bce88b582414fc282c95f5626f4">00881</a> <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> <a class="code" href="../../df/d03/cipioconnection_8c.html#a53b85bce88b582414fc282c95f5626f4" title="Take the data given in the connection object structure and open the necessary communication channels...">OpenCommunicationChannels</a>(<a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *connection_object) {
<a name="l00882"></a>00882 
<a name="l00883"></a>00883   <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709" title="EIP stack status enum.">EipStatus</a> eip_status = <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709af172c48a50748097201d49b469c75f7a">kEipStatusOk</a>;
<a name="l00884"></a>00884   <span class="comment">/*get pointer to the CPF data, currently we have just one global instance of the struct. This may change in the future*/</span>
<a name="l00885"></a>00885   <a class="code" href="../../db/d80/structCipCommonPacketFormatData.html" title="A variant of a CPF packet, including item count, one address item, one data item, and two Sockaddr In...">CipCommonPacketFormatData</a> *common_packet_format_data =
<a name="l00886"></a>00886     &amp;<a class="code" href="../../d4/d91/group__ENCAP.html#gafaae5be8de81c633ea4df46fa8b957e0" title="Data storage for the any CPF data Currently we are single threaded and need only one CPF at the time...">g_common_packet_format_data_item</a>;
<a name="l00887"></a>00887 
<a name="l00888"></a>00888   <a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#ad6b37311125336c0525f037c107e091a">ConnectionObjectConnectionType</a> originator_to_target_connection_type =
<a name="l00889"></a>00889     <a class="code" href="../../df/d91/cipconnectionobject_8c.html#aa896ebb7d03c6e75027402b3e0d6dc6e">ConnectionObjectGetOToTConnectionType</a>(connection_object);
<a name="l00890"></a>00890 
<a name="l00891"></a>00891   <a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#ad6b37311125336c0525f037c107e091a">ConnectionObjectConnectionType</a> target_to_originator_connection_type =
<a name="l00892"></a>00892     <a class="code" href="../../df/d91/cipconnectionobject_8c.html#ad61ad2b2c18480a141e5df346e32be02">ConnectionObjectGetTToOConnectionType</a>(connection_object);
<a name="l00893"></a>00893 
<a name="l00894"></a>00894   <span class="comment">/* open a connection &quot;point to point&quot; or &quot;multicast&quot; based on the ConnectionParameter */</span>
<a name="l00895"></a>00895   <span class="keywordflow">if</span> (originator_to_target_connection_type ==
<a name="l00896"></a>00896       <a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#ad6b37311125336c0525f037c107e091aa8f7d20eb5adeb31d45a0bfb62dbefe9b">kConnectionObjectConnectionTypeMulticast</a>)                                         <span class="comment">/* Multicast consuming */</span>
<a name="l00897"></a>00897   {
<a name="l00898"></a>00898     <span class="keywordflow">if</span> (<a class="code" href="../../df/d03/cipioconnection_8c.html#a9e2ce4666173987646cf60ce3422d7b4">OpenMulticastConnection</a>(<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42a922e4c2f521c295287766f9917c9fea7">kUdpCommuncationDirectionConsuming</a>,
<a name="l00899"></a>00899                                 connection_object, common_packet_format_data)
<a name="l00900"></a>00900         == <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709a1ac5aa8c4de11fc51d52843b5d173184">kEipStatusError</a>) {
<a name="l00901"></a>00901       <a class="code" href="../../d1/d1b/trace_8h.html#a48f0d8056c030015f14cf5907315e6bb">OPENER_TRACE_ERR</a>(<span class="stringliteral">&quot;error in OpenMulticast Connection\n&quot;</span>);
<a name="l00902"></a>00902       <span class="keywordflow">return</span> <a class="code" href="../../d6/d52/ciperror_8h.html#a01a2d66a1bdaea7c81e29d4d2530d218a8db04c3335e9735af7d59cf4b7cbdc4b">kCipErrorConnectionFailure</a>;
<a name="l00903"></a>00903     }
<a name="l00904"></a>00904   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (originator_to_target_connection_type ==
<a name="l00905"></a>00905              <a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#ad6b37311125336c0525f037c107e091aabc6d5acdbfa8d7cea87c20cd43e5ed56">kConnectionObjectConnectionTypePointToPoint</a>)                                  <span class="comment">/* Point to Point consuming */</span>
<a name="l00906"></a>00906   {
<a name="l00907"></a>00907     <span class="keywordflow">if</span> (<a class="code" href="../../df/d03/cipioconnection_8c.html#add645b42730b2cea369523949c6b9745" title="Open a Point2Point connection dependent on pa_direction.">OpenConsumingPointToPointConnection</a>(connection_object,
<a name="l00908"></a>00908                                             common_packet_format_data)
<a name="l00909"></a>00909         == <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709a1ac5aa8c4de11fc51d52843b5d173184">kEipStatusError</a>) {
<a name="l00910"></a>00910       <a class="code" href="../../d1/d1b/trace_8h.html#a48f0d8056c030015f14cf5907315e6bb">OPENER_TRACE_ERR</a>(<span class="stringliteral">&quot;error in PointToPoint consuming connection\n&quot;</span>);
<a name="l00911"></a>00911       <span class="keywordflow">return</span> <a class="code" href="../../d6/d52/ciperror_8h.html#a01a2d66a1bdaea7c81e29d4d2530d218a8db04c3335e9735af7d59cf4b7cbdc4b">kCipErrorConnectionFailure</a>;
<a name="l00912"></a>00912     }
<a name="l00913"></a>00913   }
<a name="l00914"></a>00914 
<a name="l00915"></a>00915   <span class="keywordflow">if</span> (target_to_originator_connection_type ==
<a name="l00916"></a>00916       <a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#ad6b37311125336c0525f037c107e091aa8f7d20eb5adeb31d45a0bfb62dbefe9b">kConnectionObjectConnectionTypeMulticast</a>)                                         <span class="comment">/* Multicast producing */</span>
<a name="l00917"></a>00917   {
<a name="l00918"></a>00918     <span class="keywordflow">if</span> (<a class="code" href="../../df/d03/cipioconnection_8c.html#a5dea6fc1be0ed4ecf5d9e4f932d52106">OpenProducingMulticastConnection</a>(connection_object,
<a name="l00919"></a>00919                                          common_packet_format_data)
<a name="l00920"></a>00920         == <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709a1ac5aa8c4de11fc51d52843b5d173184">kEipStatusError</a>) {
<a name="l00921"></a>00921       <a class="code" href="../../d1/d1b/trace_8h.html#a48f0d8056c030015f14cf5907315e6bb">OPENER_TRACE_ERR</a>(<span class="stringliteral">&quot;error in OpenMulticast Connection\n&quot;</span>);
<a name="l00922"></a>00922       <span class="keywordflow">return</span> <a class="code" href="../../d6/d52/ciperror_8h.html#a01a2d66a1bdaea7c81e29d4d2530d218a8db04c3335e9735af7d59cf4b7cbdc4b">kCipErrorConnectionFailure</a>;
<a name="l00923"></a>00923     }
<a name="l00924"></a>00924   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (target_to_originator_connection_type ==
<a name="l00925"></a>00925              <a class="code" href="../../d1/d6c/cipconnectionobject_8h.html#ad6b37311125336c0525f037c107e091aabc6d5acdbfa8d7cea87c20cd43e5ed56">kConnectionObjectConnectionTypePointToPoint</a>)                                  <span class="comment">/* Point to Point producing */</span>
<a name="l00926"></a>00926   {
<a name="l00927"></a>00927 
<a name="l00928"></a>00928     <span class="keywordflow">if</span> (<a class="code" href="../../df/d03/cipioconnection_8c.html#aa3b58fd216ec6712abc29ef84b33006d">OpenProducingPointToPointConnection</a>(connection_object,
<a name="l00929"></a>00929                                             common_packet_format_data)
<a name="l00930"></a>00930         != <a class="code" href="../../d7/d69/typedefs_8h.html#a3dcc5f7837c120360f8cc88a76781709af172c48a50748097201d49b469c75f7a">kEipStatusOk</a>) {
<a name="l00931"></a>00931       <a class="code" href="../../d1/d1b/trace_8h.html#a48f0d8056c030015f14cf5907315e6bb">OPENER_TRACE_ERR</a>(<span class="stringliteral">&quot;error in PointToPoint producing connection\n&quot;</span>);
<a name="l00932"></a>00932       <span class="keywordflow">return</span> <a class="code" href="../../d6/d52/ciperror_8h.html#a01a2d66a1bdaea7c81e29d4d2530d218a8db04c3335e9735af7d59cf4b7cbdc4b">kCipErrorConnectionFailure</a>;
<a name="l00933"></a>00933     }
<a name="l00934"></a>00934   }
<a name="l00935"></a>00935   <span class="keywordflow">return</span> eip_status;
<a name="l00936"></a>00936 }
<a name="l00937"></a>00937 
<a name="l00938"></a><a class="code" href="../../de/d45/cipioconnection_8h.html#a62fc61ed294b1d1543960582f0071b22">00938</a> <span class="keywordtype">void</span> <a class="code" href="../../df/d03/cipioconnection_8c.html#a62fc61ed294b1d1543960582f0071b22" title="close the communication channels of the given connection and remove it from the active connections li...">CloseCommunicationChannelsAndRemoveFromActiveConnectionsList</a>(
<a name="l00939"></a>00939   <a class="code" href="../../d2/da8/structcip__connection__object.html">CipConnectionObject</a> *connection_object) {
<a name="l00940"></a>00940   <a class="code" href="../../db/d4f/generic__networkhandler_8c.html#aab6e6c554aa10d27efe297ebef3ac1c9">CloseUdpSocket</a>(
<a name="l00941"></a>00941     connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#aa12a45d71134370c0f3882863840c7cd">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42a922e4c2f521c295287766f9917c9fea7">kUdpCommuncationDirectionConsuming</a>]);
<a name="l00942"></a>00942 
<a name="l00943"></a>00943   connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#aa12a45d71134370c0f3882863840c7cd">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42a922e4c2f521c295287766f9917c9fea7">kUdpCommuncationDirectionConsuming</a>] =
<a name="l00944"></a>00944     kEipInvalidSocket;
<a name="l00945"></a>00945 
<a name="l00946"></a>00946   <a class="code" href="../../db/d4f/generic__networkhandler_8c.html#aab6e6c554aa10d27efe297ebef3ac1c9">CloseUdpSocket</a>(
<a name="l00947"></a>00947     connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#aa12a45d71134370c0f3882863840c7cd">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>]);
<a name="l00948"></a>00948 
<a name="l00949"></a>00949   connection_object-&gt;<a class="code" href="../../d2/da8/structcip__connection__object.html#aa12a45d71134370c0f3882863840c7cd">socket</a>[<a class="code" href="../../d7/d69/typedefs_8h.html#a354b9a030f385814dac5d61a8eec2e42aeb4cf2b383958e411d35e88ae386c5ec">kUdpCommuncationDirectionProducing</a>] =
<a name="l00950"></a>00950     kEipInvalidSocket;
<a name="l00951"></a>00951 
<a name="l00952"></a>00952   <a class="code" href="../../d5/d35/cipconnectionmanager_8c.html#a144782b4e2a5afc89ec32854511bbea7" title="Removes connection from the list of active connections.">RemoveFromActiveConnections</a>(connection_object);
<a name="l00953"></a>00953   <a class="code" href="../../df/d91/cipconnectionobject_8c.html#a8f507fa4e57499d8b96c8adb2ad8a549">ConnectionObjectInitializeEmpty</a>(connection_object);
<a name="l00954"></a>00954 }
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="../../df/d03/cipioconnection_8c.html">cipioconnection.c</a>      </li>

    <li class="footer">Generated on Mon Jan 22 2018 21:11:37 for OpENer - Open Source EtherNet/IP(TM)  I/O Target Stack by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
